<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AV AI Info Creator</title>
    <link href="https://fonts.googleapis.com/css2?family=Anek+Kannada:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            /* Light Theme (Default) */
            --primary-light: #667eea;
            --secondary-light: #764ba2;
            --accent-light: #f093fb;
            --success-light: #4ecdc4;
            --warning-light: #f7b731;
            --danger-light: #fc4a1a;
            --dark-light: #2c3e50;
            --light-light: #ecf0f1;
            --bg-light: #f0f2f5;
            --sidebar-bg-light: rgba(255, 255, 255, 0.85);
            --text-color-light: #2c3e50;
            --subtle-border-light: #d1d9e0;

            /* Dark Theme */
            --primary-dark: #8a7ffb;
            --secondary-dark: #a06fff;
            --accent-dark: #f093fb;
            --success-dark: #5eeada;
            --warning-dark: #f7c35f;
            --danger-dark: #ff6b3d;
            --dark-dark: #e1e9f1;
            --light-dark: #3a415a;
            --bg-dark: #1a1d2e;
            --sidebar-bg-dark: rgba(26, 29, 46, 0.75);
            --text-color-dark: #e1e9f1;
            --subtle-border-dark: #4a5578;
            
            /* Themed Variables */
            --primary: var(--primary-light);
            --secondary: var(--secondary-light);
            --accent: var(--accent-light);
            --success: var(--success-light);
            --warning: var(--warning-light);
            --danger: var(--danger-light);
            --dark: var(--dark-light);
            --light: var(--light-light);
            --app-bg: var(--bg-light);
            --sidebar-bg: var(--sidebar-bg-light);
            --text-color: var(--text-color-light);
            --subtle-border: var(--subtle-border-light);
            
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --global-section-header-color: var(--gradient);
            --global-header-color: var(--primary);
            --global-paragraph-color: var(--dark);
            --global-small-text-color: #555;
        }

        .dark-theme {
            --primary: var(--primary-dark);
            --secondary: var(--secondary-dark);
            --accent: var(--accent-dark);
            --success: var(--success-dark);
            --warning: var(--warning-dark);
            --danger: var(--danger-dark);
            --dark: var(--dark-dark);
            --light: var(--light-dark);
            --app-bg: var(--bg-dark);
            --sidebar-bg: var(--sidebar-bg-dark);
            --text-color: var(--text-color-dark);
            --subtle-border: var(--subtle-border-dark);
            --global-small-text-color: #9ab;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Anek Kannada', sans-serif; 
            background: var(--app-bg);
            background-image: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh; 
            color: var(--text-color); 
            display: flex; 
            flex-direction: column;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container { display: flex; width: 100%; height: 100%; overflow: hidden; }
        
        .sidebar { 
            width: 400px; 
            background: var(--sidebar-bg);
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1); 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            transition: background 0.3s ease;
        }
        .sidebar-scroll-content { flex: 1; overflow-y: auto; padding: 20px; }
        .main-content-wrapper { flex: 1; display: flex; flex-direction: column; overflow: auto; }
        .main-content { flex-grow: 1; padding: 15px; display: flex; justify-content: center; align-items: center; overflow: hidden; }

        .logo { text-align: center; margin-bottom: 25px; }
        .logo h1 { font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 22px; }
        .logo p { color: var(--text-color); opacity: 0.8;}

        .tab-container { margin-bottom: 15px; }
        .tab-buttons { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
        .tab-btn { padding: 7px 10px; border: none; border-radius: 18px; background: var(--light); color: var(--dark); font-size: 11px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-family: 'Anek Kannada', sans-serif; }
        .tab-btn.active, .preset-btn.active { background: var(--gradient); color: white; transform: translateY(-1px); box-shadow: 0 3px 12px rgba(102, 126, 234, 0.35); }
        .tab-content { display: none; background: var(--light); border: 1px solid var(--subtle-border); border-radius: 12px; padding: 12px; margin-bottom: 12px; transition: background 0.3s, border 0.3s; }
        .tab-content.active { display: block; }
        .control-group { margin-bottom: 12px; }
        .control-group h4, .control-group h5, .control-group h6 { margin-top: 12px; margin-bottom: 6px; color: var(--primary); font-weight: 600; border-bottom: 1px solid var(--subtle-border); padding-bottom: 3px; font-size: 1em; }
        .control-label { display: block; margin-bottom: 4px; font-weight: 600; font-size: 13px; color: var(--text-color); }
        .control-label small { font-weight: 400; font-size: 0.8em; color: var(--text-color); opacity: 0.7; }
        .control-input, textarea.control-input, select.control-input { width: 100%; padding: 7px 10px; border: 1px solid var(--subtle-border); border-radius: 8px; font-family: 'Anek Kannada', sans-serif; font-size: 13px; transition: all 0.3s ease; background: var(--app-bg); color: var(--text-color); }
        input[type="file"].control-input { padding: 3px; font-size: 12px; }
        input[type="range"].control-input { padding: 0; }
        textarea.control-input { min-height: 50px; }
        .control-input:focus, textarea.control-input:focus, select.control-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px color-mix(in srgb, var(--primary) 20%, transparent); }
        .color-row { display: flex; gap: 8px; align-items: center; }
        .color-input { width: 45px; height: 30px; border: none; border-radius: 6px; cursor: pointer; padding: 1px; }
        .btn { padding: 8px 15px; border: none; border-radius: 8px; font-family: 'Anek Kannada', sans-serif; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 4px; font-size: 13px; }
        .btn-primary { background: var(--gradient); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .btn-success { background: var(--success); color: white; }
        .dark-theme .btn-success { background: color-mix(in srgb, var(--success) 80%, black); }
        .btn-success:hover { background: var(--success); filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(78, 205, 196, 0.4); }
        .alert { padding: 10px 15px; border-radius: 8px; margin-top: 15px; font-weight: 500; border: 1px solid transparent; }
        .alert-success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }

        .canvas-area { background: var(--app-bg); border-radius: 8px; padding: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; transition: background 0.3s; }
        .infographic { position: relative; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.15); overflow: hidden; display: flex; flex-direction: column; align-items: center; transform-origin: center center; transition: transform 0.3s ease; }
        
        .infographic-content { padding: 20px; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; }
        .infographic > h1.section-title,
        .infographic-content > h1.section-title { text-align: center; width: 100%; max-width: 90%; font-weight: 800; word-break: break-word; padding: 0 20px; margin-bottom: 20px; flex-shrink: 0; }

        .infographic h2, .infographic h3:not(.step-content h3), .infographic h4:not(.hierarchy-node h4) { color: var(--global-header-color); }
        .infographic p:not(.step-content p):not(.hierarchy-node p) { color: var(--global-paragraph-color); }
        .infographic small, .infographic .small-text { color: var(--global-small-text-color); }

        .social-post-infographic { display: flex; justify-content: center; align-items: center; text-align: center; color: white; padding: 40px; background-size: cover; background-position: center; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.25); }
        .social-post-infographic::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--overlay-color, #000); opacity: var(--overlay-opacity, 0.4); z-index: 1; pointer-events: none; }
        .social-post-infographic .text-content-area { z-index: 2; position: relative; width: 100%; height: 100%; }
        .social-post-infographic .header, .social-post-infographic .info-text { position: absolute; text-align: left; }
        .social-post-infographic .header { font-weight: 800; }
        .social-post-infographic .info-text { font-weight: 400; line-height: 1.6; }
        .social-post-infographic .text-has-shadow * { text-shadow: 2px 2px 8px rgba(0,0,0,0.6); }

        .bg-preset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 8px; }
        .bg-swatch { width: 100%; height: 30px; border: 2px solid transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
        .bg-swatch:hover, .bg-swatch.active { border-color: var(--primary); transform: scale(1.1); box-shadow: 0 0 8px rgba(0,0,0,0.2); }

        .sidebar-footer { padding: 15px 20px; text-align: center; background: var(--light); box-shadow: 0 -2px 8px rgba(0,0,0,0.06); flex-shrink: 0; transition: background 0.3s; }
        .action-buttons-container { margin-bottom: 10px; }
        .footer-note-container .footer-note { font-size: 0.8em; color: var(--text-color); opacity: 0.7; }
        
        .generated-table-wrapper { width: 100%; overflow-x: auto;}
        .generated-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .generated-table th, .generated-table td { padding: 10px 12px; text-align: left; border: 1px solid #ddd; }
        .generated-table th { background: var(--light); font-weight: 600; color: var(--dark); }
        .process-step { display: flex; align-items: center; margin: 15px 0; padding: 12px; border-radius: 10px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; position: relative; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.1); width: 100%; }
        .process-step::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1.5" fill="rgba(255,255,255,0.08)"/></svg>'); background-size: 15px 15px; opacity: 0.7; }
        .step-number { width: 45px; height: 45px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; margin-right: 15px; backdrop-filter: blur(3px); flex-shrink: 0; border: 1px solid rgba(255,255,255,0.2); }
        .step-number i { font-size: 20px; }
        .step-content { flex-grow: 1; min-width: 0; z-index: 1; }
        .step-content h3 { font-weight: 600; margin-bottom: 5px; word-break: break-word; color: white !important; }
        .step-content p { font-weight: 400; opacity: 0.9; font-size: 0.85em; word-break: break-word; color: white !important; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 15px 0; width: 100%;}
        .stat-card { background: linear-gradient(135deg, var(--success), color-mix(in srgb, var(--success) 70%, black)); color: white; padding: 15px; border-radius: 12px; text-align: center; position: relative; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .stat-card:nth-child(2n) { background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 70%, black)); }
        .stat-card:nth-child(3n) { background: linear-gradient(135deg, var(--warning), color-mix(in srgb, var(--warning) 70%, black)); }
        .stat-number { font-weight: 700; line-height: 1.1; margin-bottom: 8px; word-break: break-all; }
        .stat-label { font-weight: 500; opacity: 0.9; word-break: break-word; }
        .info-block-item { display: flex; gap: 15px; align-items: flex-start; padding: 15px; background: color-mix(in srgb, var(--primary) 5%, transparent); border: 1px solid color-mix(in srgb, var(--primary) 10%, transparent); border-radius: 8px; margin: 15px 0; overflow: hidden; width: 100%;}
        .info-block-item.image-left { flex-direction: row; }
        .info-block-item.image-right { flex-direction: row-reverse; } 
        .info-block-image-container { flex-shrink: 0; display: flex; justify-content: center; align-items: center; overflow: hidden; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position:relative; }
        .info-block-image-container img { display: block; border-radius: 6px; object-fit: cover; width: 100%; height: 100%; }
        .info-block-image-container.size-small { width: 70px; height: 70px; } 
        .info-block-image-container.size-medium { width: 100px; height: 100px; } 
        .info-block-image-container.size-large { width: 130px; height: 130px; } 
        .info-block-text { flex-grow: 1; min-width: 0; }
        .info-block-text h2 { margin-bottom: 6px; word-break: break-word; } 
        .info-block-text p { line-height: 1.5; word-break: break-word; } 
        .timeline-vertical-container { position: relative; padding: 15px 0; display:flex; flex-direction:column; align-items:center; width: 100%;}
        .timeline-vertical-container::before { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: var(--gradient); transform: translateX(-50%); border-radius: 2px; }
        .timeline-vertical-item { display: flex; margin: 20px 0; position: relative; width: calc(50% - 20px); max-width: 320px; } 
        .timeline-vertical-item:nth-child(odd) { align-self: flex-start; padding-right: 25px; } 
        .timeline-vertical-item:nth-child(even) { align-self: flex-end; flex-direction: row-reverse; padding-left: 25px; } 
        .timeline-vertical-content { flex: 1; padding: 12px; background: var(--light); border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); min-width: 0; border-left: 3px solid var(--primary); }
        .timeline-vertical-item:nth-child(even) .timeline-vertical-content { border-left: none; border-right: 3px solid var(--secondary); }
        .timeline-vertical-content h3 { word-break: break-word; color: var(--accent) !important; margin-bottom: 3px; text-transform: uppercase; letter-spacing: 0.5px;} 
        .timeline-vertical-content h4 { word-break: break-word; margin-bottom: 5px; font-weight:600;} 
        .timeline-vertical-content p { word-break: break-word; line-height: 1.4;} 
        .timeline-vertical-dot { width: 18px; height: 18px; border-radius: 50%; background: var(--light); border: 4px solid var(--primary); position: absolute; top: 15px; z-index: 2; box-shadow: 0 0 0 3px var(--light); }
        .timeline-vertical-item:nth-child(odd) .timeline-vertical-dot { left: 100%; transform: translateX(-50%); }
        .timeline-vertical-item:nth-child(even) .timeline-vertical-dot { left: 0%; transform: translateX(-50%); border-color: var(--secondary); }
        .timeline-horizontal-wrapper { width:100%; overflow-x:auto; padding: 10px 0;}
        .timeline-horizontal-container { display: flex; flex-direction: column; position: relative; padding: 30px 10px; min-width: fit-content; }
        .timeline-horizontal-line { position: absolute; left: 0; right: 0; top: 50%; height: 3px; background: var(--gradient); transform: translateY(-50%); z-index: 1; min-width: 100%; border-radius: 2px;}
        .timeline-horizontal-events { display: flex; position: relative; z-index: 2; padding: 0 15px; }
        .timeline-horizontal-item { display: flex; flex-direction: column; align-items: center; min-width: 130px; margin: 0 10px; position:relative; }
        .timeline-horizontal-dot { width: 16px; height: 16px; border-radius: 50%; background: var(--light); border: 3px solid var(--primary); margin-bottom: 8px; margin-top: 8px; z-index:3; box-shadow: 0 0 0 3px var(--light);}
        .timeline-horizontal-content { background: var(--light); padding: 8px 10px; border-radius: 6px; box-shadow: 0 1px 6px rgba(0,0,0,0.1); text-align: center; width:100%; min-width: 0; border-top: 3px solid var(--primary); }
        .timeline-horizontal-item:nth-child(odd) .timeline-horizontal-content { margin-bottom: 25px; }
        .timeline-horizontal-item:nth-child(even) .timeline-horizontal-content { margin-top: 25px; border-top-color: var(--secondary); }
        .timeline-horizontal-item:nth-child(odd) .timeline-horizontal-dot { order: 2; }
        .timeline-horizontal-item:nth-child(even) .timeline-horizontal-dot { order: -1; border-color: var(--secondary); }
        .timeline-horizontal-content h3 { color: var(--accent) !important; margin-bottom: 2px; word-break: break-all; text-transform: uppercase;}
        .timeline-horizontal-content h4 { margin-bottom: 3px; word-break: break-all; font-weight:600;} 
        .timeline-horizontal-content p { color: var(--text-color) !important; opacity: 0.8; word-break: break-all; line-height: 1.3;} 
        .chart-container { margin: 20px 0; padding: 15px; background: var(--light); border-radius: 8px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); display: flex; flex-direction: column; width: 100%; max-width: 95%;}
        .chart-container h3.chart-title {text-align: center; margin-bottom: 15px; font-weight: 700;} 
        .chart-canvas-wrapper { position: relative; height: 250px; width: 100%; } 
        .dam-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin: 15px 0; width: 100%;}
        .dam-card { padding: 15px; border-radius:10px; color:white; text-align:center; }
        .dam-name { font-weight:600; margin-bottom:5px; color:white !important;}
        .dam-level { font-weight:700; margin-bottom:5px; color:white !important;}
        .dam-progress-bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; margin-top: 8px; overflow:hidden; }
        .dam-progress-bar-fg { height: 100%; background: white; border-radius: 4px; }
        .dam-capacity-info { margin-top:8px; opacity:0.9; color:white !important;}
        .dam-progress-label { margin-top: 5px; opacity: 0.8; color:white !important;}
        .price-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 15px 0; width: 100%;}
        .price-card { padding: 18px; border-radius: 10px; text-align: center; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .price-card * { color: white !important; } 
        .price-label { font-weight: 600; margin-bottom: 8px; }
        .price-value { font-weight: 700; margin-bottom: 5px; }
        .price-unit { opacity: 0.9; margin-bottom: 10px;}
        .price-update-info { opacity: 0.8; margin-top:10px; }
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 15px 0; width: 100%;}
        .comparison-card { background: var(--light); border-radius: 10px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-top: 4px solid var(--primary); }
        .comparison-card:nth-child(even) { border-top-color: var(--secondary); }
        .comparison-card h3 { margin-bottom: 8px; text-align:center; } 
        .comparison-card .price { color: var(--accent) !important; margin-bottom: 15px; text-align:center; font-weight:600; }
        .comparison-card ul { list-style: none; padding: 0; margin:0; }
        .comparison-card ul li { padding: 8px 0; border-bottom: 1px solid var(--subtle-border); display:flex; align-items:center; } 
        .comparison-card ul li:last-child { border-bottom: none; }
        .comparison-card ul li i { color: var(--success) !important; margin-right: 8px; }
        .hierarchy-container { text-align: center; margin: 15px 0; width: 100%;}
        .hierarchy-node { background: var(--primary); color: white; padding: 10px 15px; border-radius: 8px; display: inline-block; margin: 10px; min-width:150px; }
        .hierarchy-node h4 { margin-bottom: 5px; color:white !important; }
        .hierarchy-node p { opacity: 0.9; color:white !important; }
        .hierarchy-children { margin-top: 15px; display:flex; justify-content:center; gap:15px; flex-wrap:wrap; }
        .hierarchy-connector { width: 2px; height: 20px; background: #ccc; margin: 0 auto; } 
        .list-infographic-item { display: flex; align-items: flex-start; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.07); width: 100%;}
        .list-infographic-item .icon { font-size: 1.8em; color: var(--primary) !important; margin-right: 15px; min-width:30px; text-align:center; }
        .list-infographic-item .text-content h4 { margin-bottom: 5px; font-weight:600; } 
        .list-infographic-item .text-content p { line-height:1.4; } 
        .coming-up-infographic { display: flex; align-items: center; text-align: center; width: 100%; position: relative; }
        .coming-up-infographic .infographic-content { padding: 20px; }
        .coming-up-infographic .image-container { position:relative; width:100%; max-width: 80%; margin-bottom: 15px; } 
        .coming-up-infographic .image-container.full-width-bg { max-width: 100%; height: 100%; position: absolute; top:0; left:0; z-index:0;}
        .coming-up-infographic img.main-image { width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); object-fit: cover; max-height: 300px; display:block; }
        .coming-up-infographic .image-container.full-width-bg img.main-image {border-radius:0; max-height:none; height:100%;}
        .coming-up-infographic .text-content-area { z-index: 1; position:relative; width:100%; } 
        .coming-up-infographic .header { font-weight: 700; } 
        .coming-up-infographic .sub-header { font-weight: 500; } 
        .coming-up-infographic .info-text { max-width: 90%; line-height: 1.5; margin-left:auto; margin-right:auto;} 
        .coming-up-infographic .date-time { font-weight: 600; color: var(--accent) !important; background-color: rgba(255,255,255,0.8); padding: 8px 15px; border-radius: 20px; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
        
        .global-brand-logo-overlay, .global-brand-text-overlay { 
            position: absolute; 
            z-index: 99; 
            display: flex; 
            align-items: center; 
            padding: 5px 8px; 
            background-color: rgba(0, 0, 0, 0.4); 
            border-radius: 4px; 
            pointer-events: none; 
        }
        .global-brand-logo-overlay img { max-height: 20px; width: auto; display: block; }
        .global-brand-text-overlay span { font-family: 'Anek Kannada', sans-serif; font-weight: 500; }
        .brand-pos-bottom-left { bottom: 10px; left: 10px; }
        .brand-pos-bottom-right { bottom: 10px; right: 10px; }
        .brand-pos-top-left { top: 10px; left: 10px; }
        .brand-pos-top-right { top: 10px; right: 10px; }
        .brand-pos-center { top: 50%; left: 50%; transform: translate(-50%, -50%); }

        .theme-switcher { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: var(--light); border-radius: 12px; margin-bottom: 20px; }
        .theme-switcher label { font-weight: 600; color: var(--text-color); }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 26px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }

        @media (max-width: 1200px) { .sidebar { width: 320px; } }
        @media (max-width: 992px) { 
            html, body { overflow: auto; }
            .container { flex-direction: column; height: auto; overflow: visible; }
            .sidebar { width: 100%; border-radius: 0; max-height: none; height: auto; border-right: none; border-bottom: 1px solid rgba(255, 255, 255, 0.1);}
            .main-content-wrapper { height: auto; }
            .main-content { min-height: 80vh; padding: 10px; }
            .canvas-area { height: auto; min-height: 350px; padding: 20px; }
        }
        @media (max-width: 768px) {
            .canvas-area { padding: 15px; }
            .infographic-content { padding: 15px; } 
            .timeline-vertical-container::before { left: 15px; } 
            .timeline-vertical-item { width: calc(100% - 30px); align-self: flex-start !important; flex-direction: row !important; padding-left: 30px !important; margin-left: 15px; padding-right:0 !important; }
            .timeline-vertical-item .timeline-vertical-dot { left: 0px; transform: translateX(-50%); top: 15px; width:16px; height:16px; }
            .timeline-vertical-content { margin-left: 10px; padding: 10px; }
            .timeline-vertical-item:nth-child(even) { flex-direction: row !important; } 
            .timeline-vertical-item:nth-child(even) .timeline-vertical-content { border-left: 3px solid var(--secondary); border-right: none; }
            .info-block-item { flex-direction: column !important; gap: 8px; margin: 10px 0; padding: 10px; }
            .info-block-image-container { margin: 0 auto 10px auto; }
            .timeline-horizontal-events { padding: 0 5px; }
            .timeline-horizontal-item { min-width: 120px; margin: 0 5px;}
            .stat-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:10px; }
            .dam-grid { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap:10px; }
            .price-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:10px; }
            .comparison-grid { grid-template-columns: 1fr; gap:15px; } 
            .coming-up-infographic .header { font-size: 1.5em; }
            .coming-up-infographic .sub-header { font-size: 1.1em; }
            .coming-up-infographic .info-text { font-size: 0.9em; }
            .coming-up-infographic .date-time { font-size: 0.9em; padding: 6px 12px;}
            .coming-up-infographic.layout-image-left .image-container,
            .coming-up-infographic.layout-image-right .image-container { max-width: 40%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-scroll-content">
                <div class="logo">
                    <h1><i class="fas fa-chart-line"></i> AV AI Info Creator</h1>
                    <p>Create stunning infographics</p>
                </div>

                <div class="theme-switcher">
                    <label for="themeToggle">Dark Mode</label>
                    <label class="switch">
                        <input type="checkbox" id="themeToggle" class="control-input">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="social">Social</button>
                        <button class="tab-btn" data-tab="process">Process</button>
                        <button class="tab-btn" data-tab="textToTable">Text to Table</button>
                        <button class="tab-btn" data-tab="timeline">Timeline</button>
                        <button class="tab-btn" data-tab="barChart">Bar Chart</button>
                        <button class="tab-btn" data-tab="pieChart">Pie Chart</button>
                        <button class="tab-btn" data-tab="dams">Dams</button>
                        <button class="tab-btn" data-tab="prices">Prices</button>
                        <button class="tab-btn" data-tab="comparison">Compare</button>
                        <button class="tab-btn" data-tab="hierarchical">Hierarchy</button>
                        <button class="tab-btn" data-tab="list">List</button>
                        <button class="tab-btn" data-tab="comingUp">Coming Up</button>
                    </div>

                    <div class="tab-content active" id="social">
                        <h3>Social Post</h3>
                        <div class="control-group"> <label>Background Image URL</label> <input type="url" class="control-input" id="socialImageUrl" placeholder="https://images.unsplash.com/photo-1506744038136-46273834b3fb"> </div>
                        <div class="control-group"> <label>Upload Background Image</label> <input type="file" class="control-input" id="socialImageUpload" accept="image/*"></div>
                        <h6>Background Image Adjustments</h6>
                        <div class="control-group"> <label>Zoom (%)</label> <input type="range" class="control-input" id="socialBgZoom" min="50" max="300" value="100"> </div>
                        <div class="control-group"> <label>Position X (px)</label> <input type="number" class="control-input" id="socialBgPosX" value="0" step="5"> </div>
                        <div class="control-group"> <label>Position Y (px)</label> <input type="number" class="control-input" id="socialBgPosY" value="0" step="5"> </div>
                        
                        <h6>Header Text Settings</h6>
                        <div class="control-group"> <label>Header Text</label> <input type="text" class="control-input" id="socialHeader" value="Inspirational Quote"> </div>
                        <div class="control-group"> <label>Font Size (px)</label> <input type="number" class="control-input" id="socialHeaderFontSize" value="42"> </div>
                        <div class="control-group"> <label>Text Color</label> <input type="color" class="control-input" id="socialHeaderTextColor" value="#FFFFFF"> </div>
                        <div class="control-group"> <label>Position X (px)</label> <input type="number" class="control-input" id="socialHeaderPosX" value="40"> </div>
                        <div class="control-group"> <label>Position Y (px)</label> <input type="number" class="control-input" id="socialHeaderPosY" value="400"> </div>
                        
                        <h6>Info Text Settings</h6>
                        <div class="control-group"> <label>Information Text</label> <textarea class="control-input" id="socialInfoText" rows="3">"The only way to do great work is to love what you do." - Steve Jobs</textarea> </div>
                        <div class="control-group"> <label>Font Size (px)</label> <input type="number" class="control-input" id="socialInfoTextFontSize" value="24"> </div>
                        <div class="control-group"> <label>Text Color</label> <input type="color" class="control-input" id="socialInfoTextColor" value="#FFFFFF"> </div>
                        <div class="control-group"> <label>Position X (px)</label> <input type="number" class="control-input" id="socialInfoTextPosX" value="40"> </div>
                        <div class="control-group"> <label>Position Y (px)</label> <input type="number" class="control-input" id="socialInfoTextPosY" value="500"> </div>
                        
                        <h6>Overlay & Effects</h6>
                        <div class="control-group"> <label>Background Overlay Color</label> <input type="color" class="control-input" id="socialOverlayColor" value="#000000"> </div>
                        <div class="control-group"> <label>Background Overlay Opacity</label> <input type="range" class="control-input" id="socialOverlayOpacity" min="0" max="1" step="0.05" value="0.4"> </div>
                        <div class="control-group"> <label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" id="socialTextShadow" class="control-input" checked style="width: auto;"> Add Text Shadow</label></div>
                    </div>

                    <div class="tab-content" id="process">
                        <h3>Process Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="processSectionTitle" value="Our Workflow"> </div>
                        <div class="control-group"> <label>Step Titles <small>(CSV)</small></label> <textarea class="control-input" id="processStepTitlesCSV" rows="2">Discovery,Design,Development,Deployment</textarea> </div>
                        <div class="control-group"> <label>Step Descriptions <small>(CSV)</small></label> <textarea class="control-input" id="processStepDescsCSV" rows="3">Research & planning phase.,Wireframing & UI design concepts.,Coding & building the application.,Final testing & official launch.</textarea> </div>
                        <div class="control-group"> <label>Step Icon <small>(FA class or text, CSV)</small></label> <input type="text" class="control-input" id="processStepIconsCSV" placeholder="fas fa-search,fas fa-palette,fas fa-code,fas fa-rocket" value="fas fa-search,fas fa-palette,fas fa-code,fas fa-rocket"> </div>
                    </div>
                    <div class="tab-content" id="statistical">
                        <h3>Statistical Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="statSectionTitle" value="Key Performance Indicators"> </div>
                        <div class="control-group"> <label>Stat Values <small>(CSV)</small></label> <textarea class="control-input" id="statValuesCSV" rows="2">85%,2.5M,150+,9.2/10</textarea> </div>
                        <div class="control-group"> <label>Stat Labels <small>(CSV)</small></label> <textarea class="control-input" id="statLabelsCSV" rows="2">Success Rate,Active Users,Countries Reached,Avg. Rating</textarea> </div>
                    </div>
                    <div class="tab-content" id="textToTable">
                        <h3>Text to Table Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="tableSectionTitle" value="Data Overview"> </div>
                         <div class="control-group">
                            <label for="tableInputText">Input Text Data:</label>
                            <textarea id="tableInputText" class="control-input" rows="5" placeholder="Paste text here. Use tabs, commas, or vertical format."></textarea>
                        </div>
                        <div class="control-group">
                            <label for="tableDataFormat">Data Format:</label>
                            <select id="tableDataFormat" class="control-input">
                                <option value="tabular">Tabular (Columns)</option>
                                <option value="vertical">Vertical (Key: Value)</option>
                            </select>
                        </div>
                        <div class="control-group" id="tableSeparatorGroup">
                            <label for="tableSeparator">Column Separator:</label>
                            <select id="tableSeparator" class="control-input">
                                <option value="\t">Tab</option>
                                <option value=",">Comma (,)</option>
                                <option value="|">Pipe (|)</option>
                                <option value=";">Semicolon (;)</option>
                            </select>
                        </div>
                        <div class="control-group" id="tableVerticalOptions" style="display: none;">
                            <label for="tableFieldSeparator">Field-Value Separator:</label>
                            <select id="tableFieldSeparator" class="control-input">
                                <option value=" : ">Space-Colon-Space</option>
                                <option value=":">Colon</option>
                                <option value=" - ">Space-Dash-Space</option>
                                <option value="=">Equals</option>
                            </select>
                        </div>
                        <div class="control-group" id="tableHasHeaderGroup">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="tableHasHeader" class="control-input" checked style="width: auto;"> First row is header
                            </label>
                        </div>
                        <h6>Table Styling</h6>
                        <div class="control-group"> <label>Header BG Color</label> <input type="color" class="control-input" id="tableHeaderBgColor" value="#f2f2f2"> </div>
                        <div class="control-group"> <label>Header Text Color</label> <input type="color" class="control-input" id="tableHeaderTextColor" value="#333333"> </div>
                        <div class="control-group"> <label>Odd Row BG Color</label> <input type="color" class="control-input" id="tableOddRowBgColor" value="#ffffff"> </div>
                        <div class="control-group"> <label>Even Row BG Color</label> <input type="color" class="control-input" id="tableEvenRowBgColor" value="#f9f9f9"> </div>
                        <div class="control-group"> <label>Border Color</label> <input type="color" class="control-input" id="tableBorderColor" value="#dddddd"> </div>
                        <div class="control-group"> <label>Body Text Color</label> <input type="color" class="control-input" id="tableBodyTextColor" value="#333333"> </div>

                        <div class="control-group">
                            <button class="btn btn-success" onclick="copyGeneratedTable()" style="width: 100%;">
                                <i class="fas fa-copy"></i> Copy Table for Pasting
                            </button>
                        </div>
                         <div id="tableAlertContainer"></div>
                    </div>
                    <div class="tab-content" id="informational">
                        <h3>Informational Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="infoSectionTitle" value="Important Information"> </div>
                        <div class="control-group"> <label>Number of Info Blocks (1-5)</label> <input type="number" class="control-input" id="infoBlockCount" value="1" min="1" max="5"> </div>
                        <div id="infoBlockControlsContainer"></div>
                    </div>
                    <div class="tab-content" id="timeline">
                        <h3>Timeline Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="timelineSectionTitle" value="Project Milestones"> </div>
                        <div class="control-group"> <label>Layout Type</label> <select class="control-input" id="timelineLayoutType"> <option value="vertical">Vertical (Alternating)</option> <option value="horizontal">Horizontal (Scrollable)</option> </select> </div>
                        <div class="control-group"> <label>Event Dates/Subtitles <small>(CSV)</small></label> <textarea class="control-input" id="timelineEventDatesCSV" rows="2">2020,Q1 '21,Jan '22,Dec '23</textarea> </div>
                        <div class="control-group"> <label>Event Titles <small>(CSV)</small></label> <textarea class="control-input" id="timelineEventTitlesCSV" rows="2">Foundation,Product Launch,Version 2.0,Global Expansion</textarea> </div>
                        <div class="control-group"> <label>Event Descriptions <small>(CSV)</small></label> <textarea class="control-input" id="timelineEventDescsCSV" rows="3">Company officially established and initial funding secured.,Our flagship product is introduced to the market.,Major update with new features and improved performance.,Services expanded to new international regions.</textarea> </div>
                    </div>
                    <div class="tab-content" id="barChart">
                        <h3>Bar Chart Infographic</h3>
                        <div class="control-group"> <label>Section Header (Optional)</label> <input type="text" class="control-input" id="barChartSectionTitle" value="Data Analysis"> </div>
                        <div class="control-group"> <label>Chart Title</label> <input type="text" class="control-input" id="barChartTitle" value="Monthly Revenue (₹ Lakhs)"> </div>
                        <div class="control-group"> <label>Chart Height (px)</label> <input type="number" class="control-input" id="barChartHeight" value="250"> </div>
                        <div class="control-group"> 
                            <label>Legend Position</label> 
                            <select class="control-input" id="barChartLegendPos">
                                <option value="top">Top</option>
                                <option value="bottom" selected>Bottom</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                                <option value="hidden">Hidden</option>
                            </select> 
                        </div>
                        <div class="control-group"> <label>Legend Font Size (px)</label> <input type="number" class="control-input" id="barChartLegendFontSize" value="12"> </div>
                        <div class="control-group"> <label>Data Labels <small>(CSV)</small></label> <input type="text" class="control-input" id="barChartLabelsCSV" value="Jan,Feb,Mar,Apr,May,Jun"> </div>
                        <div class="control-group"> <label>Data Values <small>(CSV)</small></label> <input type="text" class="control-input" id="barChartDataCSV" value="120,190,150,250,220,300"> </div>
                    </div>
                    <div class="tab-content" id="pieChart">
                        <h3>Pie Chart Infographic</h3>
                        <div class="control-group"> <label>Section Header (Optional)</label> <input type="text" class="control-input" id="pieChartSectionTitle" value="Distribution Data"> </div>
                        <div class="control-group"> <label>Chart Title</label> <input type="text" class="control-input" id="pieChartUserTitle" value="User Demographics (%)"> </div>
                        <div class="control-group"> <label>Chart Height (px)</label> <input type="number" class="control-input" id="pieChartHeight" value="250"> </div>
                        <div class="control-group"> 
                            <label>Legend Position</label> 
                            <select class="control-input" id="pieChartLegendPos">
                                <option value="top">Top</option>
                                <option value="bottom" selected>Bottom</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                                <option value="hidden">Hidden</option>
                            </select> 
                        </div>
                        <div class="control-group"> <label>Legend Font Size (px)</label> <input type="number" class="control-input" id="pieChartLegendFontSize" value="12"> </div>
                        <div class="control-group"> <label>Data Labels <small>(CSV)</small></label> <input type="text" class="control-input" id="pieChartLabelsCSV" value="Mobile,Desktop,Tablet,Other"> </div>
                        <div class="control-group"> <label>Data Values <small>(CSV)</small></label> <input type="text" class="control-input" id="pieChartDataCSV" value="60,25,10,5"> </div>
                    </div>
                    <div class="tab-content" id="comparison">
                        <h3>Comparison Infographic</h3>
                         <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="compareSectionTitle" value="Choose Your Plan"> </div>
                        <h4>Item 1</h4>
                        <div class="control-group"> <label>Header</label> <input type="text" class="control-input" id="compareItem1Title" value="Basic Plan"> </div>
                        <div class="control-group"> <label>Sub-Header/Price</label> <input type="text" class="control-input" id="compareItem1Price" value="₹999 / month"> </div>
                        <div class="control-group"> <label>Features <small>(CSV)</small></label> <textarea class="control-input" id="compareItem1FeaturesCSV" rows="2">5 Projects,10GB Storage,Email Support,Community Access</textarea> </div>
                        <h4>Item 2</h4>
                        <div class="control-group"> <label>Header</label> <input type="text" class="control-input" id="compareItem2Title" value="Pro Plan"> </div>
                        <div class="control-group"> <label>Sub-Header/Price</label> <input type="text" class="control-input" id="compareItem2Price" value="₹1999 / month"> </div>
                        <div class="control-group"> <label>Features <small>(CSV)</small></label> <textarea class="control-input" id="compareItem2FeaturesCSV" rows="2">Unlimited Projects,100GB Storage,Priority Support,API Access,Advanced Analytics</textarea> </div>
                    </div>
                    <div class="tab-content" id="hierarchical">
                        <h3>Hierarchical Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="hierarchySectionTitle" value="Organizational Chart"> </div>
                        <h4>Level 1 (Top)</h4>
                        <div class="control-group"> <label>Title</label> <input type="text" class="control-input" id="hierarchyL1Title" value="CEO"> </div>
                        <div class="control-group"> <label>Description</label> <input type="text" class="control-input" id="hierarchyL1Desc" value="Overall strategy & vision"> </div>
                        <h4>Level 2 - Children of Level 1 <small>(CSV for titles)</small></h4>
                        <div class="control-group"> <label>Titles</label> <textarea class="control-input" id="hierarchyL2TitlesCSV" rows="1">CTO,COO,CMO</textarea> </div>
                        <div class="control-group"> <label>Descriptions <small>(CSV, matches titles)</small></label> <textarea class="control-input" id="hierarchyL2DescsCSV" rows="2">Tech & Engineering,Operations,Marketing & Sales</textarea> </div>
                         <p style="font-size:0.8em; opacity:0.7;">Simple 2-level hierarchy.</p>
                    </div>
                    <div class="tab-content" id="list">
                         <h3>List Infographic</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="listSectionTitle" value="Key Advantages"> </div>
                        <div class="control-group"> <label>Item Titles <small>(CSV)</small></label> <textarea class="control-input" id="listItemTitlesCSV" rows="2" placeholder="Title 1,Title 2,...">Innovative Solutions,Expert Team,Client-Centric Focus,Proven Results</textarea> </div>
                        <div class="control-group"> <label>Item Descriptions <small>(CSV)</small></label> <textarea class="control-input" id="listItemDescsCSV" rows="3" placeholder="Desc 1,Desc 2,...">Cutting-edge technology and approaches.,Highly skilled and experienced professionals.,We prioritize your needs and goals above all.,A track record of delivering successful outcomes.</textarea> </div>
                        <div class="control-group"> <label>Item Icons <small>(Optional CSV: FA class or text)</small></label> <textarea class="control-input" id="listItemIconsCSV" rows="1" placeholder="fas fa-lightbulb,fas fa-users,fas fa-bullseye,fas fa-chart-line">fas fa-lightbulb,fas fa-users,fas fa-bullseye,fas fa-chart-line</textarea> </div>
                    </div>
                    <div class="tab-content" id="dams">
                        <h3>Dam Water Levels</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="damSectionTitle" value="Reservoir Status"> </div>
                        <div class="control-group">
                            <label>Card Color Logic</label>
                            <select id="damColorLogic" class="control-input">
                                <option value="performance" selected>Performance Based (G/Y/R)</option>
                                <option value="cycle">Cycle Theme Colors</option>
                                <option value="shuffle">Shuffle Theme Colors</option>
                            </select>
                        </div>
                        <div class="control-group"> <label>Level Font Size (px)</label> <input type="number" class="control-input" id="damLevelFontSize" value="36"> </div>
                        <div class="control-group"> <label>Card Width (px)</label> <input type="number" class="control-input" id="damCardWidth" value="150"> </div>
                        <div class="control-group"> <label>Dam Names <small>(CSV)</small></label> <textarea class="control-input" id="damNamesCSV" rows="2">KRS Dam,Kabini Reservoir,Hemavathi Dam</textarea> </div>
                        <div class="control-group"> <label>Present Levels <small>(CSV)</small></label> <textarea class="control-input" id="damPresentLevelsCSV" rows="2" placeholder="100,80,110">100,80,110</textarea> </div>
                        <div class="control-group"> <label>Max Capacities <small>(CSV)</small></label> <textarea class="control-input" id="damMaxCapacitiesCSV" rows="2" placeholder="124.8,98.5,129.6">124.8,98.5,129.6</textarea> </div>
                        <div class="control-group">
                            <label class="control-label">Unit of Measurement</label>
                            <select class="control-input" id="damUnitOfMeasure">
                                <option value="TMC">TMC</option>
                                <option value="Feet">Feet</option>
                                <option value="Meters">Meters</option>
                                <option value="GL">GL (Giga Litres)</option>
                            </select>
                        </div>
                        <div class="control-group"> <label>Progress Bar Label</label> <input type="text" class="control-input" id="damProgressLabel" value="Current Storage"> </div>
                    </div>
                    <div class="tab-content" id="prices">
                        <h3>Gold & Silver Rates</h3>
                        <div class="control-group"> <label>Section Header</label> <input type="text" class="control-input" id="priceSectionTitle" value="Precious Metal Prices"> </div>
                        <div class="control-group">
                            <label>Card Color Logic</label>
                            <select id="priceColorLogic" class="control-input">
                                <option value="default" selected>Default Gradients</option>
                                <option value="cycle">Cycle Theme Colors</option>
                                <option value="shuffle">Shuffle Theme Colors</option>
                            </select>
                        </div>
                        <div class="control-group"> <label>Card Width (px)</label> <input type="number" class="control-input" id="priceCardWidth" value="180"> </div>
                        <h4>Item 1 (e.g., Gold 24K)</h4>
                        <div class="control-group"> <label>Label</label> <input type="text" class="control-input" id="priceItem1Label" value="24K Gold"> </div>
                        <div class="control-group"> <label>Rate (₹)</label> <input type="number" class="control-input" id="priceItem1Rate" value="72500"> </div>
                        <div class="control-group"> <label>Unit</label> <input type="text" class="control-input" id="priceItem1Unit" value="per 10 grams"> </div>
                        <h4>Item 2 (e.g., Gold 22K)</h4>
                        <div class="control-group"> <label>Label</label> <input type="text" class="control-input" id="priceItem2Label" value="22K Gold"> </div>
                        <div class="control-group"> <label>Rate (₹)</label> <input type="number" class="control-input" id="priceItem2Rate" value="68300"> </div>
                        <div class="control-group"> <label>Unit</label> <input type="text" class="control-input" id="priceItem2Unit" value="per 10 grams"> </div>
                        <h4>Item 3 (e.g., Silver)</h4>
                        <div class="control-group"> <label>Label</label> <input type="text" class="control-input" id="priceItem3Label" value="Silver"> </div>
                        <div class="control-group"> <label>Rate (₹)</label> <input type="number" class="control-input" id="priceItem3Rate" value="85500"> </div>
                        <div class="control-group"> <label>Unit</label> <input type="text" class="control-input" id="priceItem3Unit" value="per kilogram"> </div>
                        <div class="control-group"> <label>Update Info Label</label> <input type="text" class="control-input" id="priceUpdateLabel" value="Last updated: Today"> </div>
                    </div>
                    <div class="tab-content" id="comingUp">
                        <h3>Coming Up Infographic</h3>
                        <div class="control-group"> <label>Image URL</label> <input type="url" class="control-input" id="comingUpImageUrl" placeholder="https://placehold.co/600x300/667eea/white?text=Event+Image"> </div>
                        <div class="control-group"> <label>Upload Image</label> <input type="file" class="control-input" id="comingUpImageUpload" accept="image/*"></div>
                        <div class="control-group"> <label>Image Position</label> 
                            <select class="control-input" id="comingUpImagePosition">
                                <option value="top" selected>Image Top, Text Below</option>
                                <option value="bottom">Text Top, Image Below</option>
                                <option value="left">Image Left, Text Right</option>
                                <option value="right">Text Left, Image Right</option>
                                <option value="background">Image as Background, Text Overlay</option>
                            </select>
                        </div>
                        <div class="control-group"> <label>Header</label> <input type="text" class="control-input" id="comingUpHeader" value="Exciting Event Ahead!"> </div>
                        <div class="control-group"> <label>Sub-Header</label> <input type="text" class="control-input" id="comingUpSubHeader" value="Don't Miss Out"> </div>
                        <div class="control-group"> <label>Information Text</label> <textarea class="control-input" id="comingUpInfoText" rows="3">Join us for an amazing experience. More details to follow soon. This will be a game-changer!</textarea> </div>
                        <div class="control-group"> <label>Date</label> <input type="text" class="control-input" id="comingUpDate" value="October 26, 2025"> </div>
                        <div class="control-group"> <label>Time</label> <input type="text" class="control-input" id="comingUpTime" value="7:00 PM IST"> </div>
                    </div>
                </div>

                <div class="control-group" style="padding-top: 10px; border-top: 1px solid var(--subtle-border);"> <h4>Global Settings</h4> </div>
                <div class="control-group"> <label>Canvas Width (px)</label> <input type="number" class="control-input" id="canvasWidth" value="1080" step="10"> </div>
                <div class="control-group"> <label>Canvas Height (px)</label> <input type="number" class="control-input" id="canvasHeight" value="1080" step="10"> </div>
                <div class="control-group"> <label>Canvas Presets</label> <div class="tab-buttons" id="canvasPresetButtons" style="flex-wrap: wrap; gap: 3px; justify-content: flex-start;"> <button class="tab-btn preset-btn active" data-width="1080" data-height="1080">Insta Post (1:1)</button> <button class="tab-btn preset-btn" data-width="1080" data-height="1920">Story (9:16)</button> <button class="tab-btn preset-btn" data-width="1200" data-height="630">Facebook (1.91:1)</button> <button class="tab-btn preset-btn" data-width="1600" data-height="900">16:9 HD</button> <button class="tab-btn preset-btn" data-width="1000" data-height="1500">Pinterest (2:3)</button> <button class="tab-btn preset-btn" data-width="800" data-height="1000">Default</button> </div> </div>
                <div class="control-group"> <label>Overall Font Weight</label> <select class="control-input" id="fontWeight"> <option value="400">Normal</option> <option value="500">Medium</option> <option value="600">Semi Bold</option> <option value="700">Bold</option> <option value="800">Extra Bold</option> </select> </div>
                <h5>Global Sizing</h5>
                <div class="control-group"> <label>Content Padding (px)</label> <input type="number" class="control-input" id="globalContentPadding" value="20"> </div>
                <h5>Global Font Sizes (px)</h5>
                <div class="control-group"> <label>Section Title Font Size</label> <input type="number" class="control-input" id="globalSectionTitleFontSize" value="28" min="10" max="72"> </div>
                <div class="control-group"> <label>Header Font Size (H2, H3, etc.)</label> <input type="number" class="control-input" id="globalHeaderFontSize" value="20" min="8" max="48"> </div>
                <div class="control-group"> <label>Paragraph Font Size</label> <input type="number" class="control-input" id="globalParagraphFontSize" value="14" min="6" max="36"> </div>
                <div class="control-group"> <label>Small Text Font Size</label> <input type="number" class="control-input" id="globalSmallTextFontSize" value="11" min="5" max="24"> </div>
                <h5>Global Text Colors</h5>
                <div class="control-group"> <label>Section Title Color</label> <input type="color" class="control-input" id="globalSectionTitleColor" value="#667eea"> </div>
                <div class="control-group"> <label>Header Color</label> <input type="color" class="control-input" id="globalHeaderColor" value="#764ba2"> </div>
                <div class="control-group"> <label>Paragraph Color</label> <input type="color" class="control-input" id="globalParagraphColor" value="#2c3e50"> </div>
                <div class="control-group"> <label>Small Text Color</label> <input type="color" class="control-input" id="globalSmallTextColor" value="#555555"> </div>
                <h5>Global Spacing (px)</h5>
                <div class="control-group"> <label>Margin Below Section Title</label> <input type="number" class="control-input" id="globalSectionTitleMarginBottom" value="20" min="0"></div>
                <div class="control-group"> <label>Margin Below Headers (H2,H3)</label> <input type="number" class="control-input" id="globalHeaderMarginBottom" value="10" min="0"></div>
                <div class="control-group"> <label>Margin Below Sub-Headers</label> <input type="number" class="control-input" id="globalSubHeaderMarginBottom" value="8" min="0"></div>
                <div class="control-group"> <label>Paragraph Line Height (e.g., 1.6)</label> <input type="number" class="control-input" id="globalParagraphLineHeight" value="1.6" step="0.1" min="1"></div>
                <div class="control-group"> <label>Theme Colors</label> <div class="color-row"> <input type="color" class="control-input" id="primaryColor" value="#667eea"> <input type="color" class="control-input" id="secondaryColor" value="#764ba2"> <input type="color" class="control-input" id="accentColor" value="#f093fb"> </div> </div>
                
                <h5>Infographic Background</h5>
                <div class="control-group">
                    <label>Background Presets</label>
                    <div class="bg-preset-grid" id="bgPresetGrid">
                        <button class="bg-swatch" style="background: #ffffff;" data-bg="#ffffff"></button>
                        <button class="bg-swatch" style="background: #f0f2f5;" data-bg="#f0f2f5"></button>
                        <button class="bg-swatch" style="background: #2c3e50;" data-bg="#2c3e50"></button>
                        <button class="bg-swatch" style="background: linear-gradient(135deg, #667eea, #764ba2);" data-bg="linear-gradient(135deg, #667eea, #764ba2)"></button>
                        <button class="bg-swatch" style="background: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);" data-bg="linear-gradient(to right, #ffecd2 0%, #fcb69f 100%)"></button>
                        <button class="bg-swatch" style="background: linear-gradient(to top, #30cfd0 0%, #330867 100%);" data-bg="linear-gradient(to top, #30cfd0 0%, #330867 100%)"></button>
                        <button class="bg-swatch" style="background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);" data-bg="linear-gradient(120deg, #f6d365 0%, #fda085 100%)"></button>
                        <button class="bg-swatch" style="background: linear-gradient(to right, #43e97b 0%, #38f9d7 100%);" data-bg="linear-gradient(to right, #43e97b 0%, #38f9d7 100%)"></button>
                    </div>
                </div>
                <div class="control-group"> <label>Custom Background</label> <select class="control-input" id="infographicBackgroundType"> <option value="solid">Solid/Gradient</option> <option value="image">Image URL</option> <option value="transparent">Transparent (for PNG)</option></select> </div>
                <div class="control-group" id="infographicBackgroundImageControl" style="display:none;"> 
                    <label>BG Image URL</label> <input type="url" class="control-input" id="infographicBackgroundImageUrl" placeholder="https://example.com/bg.jpg"> 
                    <label>Upload BG Image</label> <input type="file" class="control-input" id="infographicBackgroundImageUpload" accept="image/*">
                    <h6>Background Image Adjustments</h6>
                    <div class="control-group"> <label>Zoom (%)</label> <input type="range" class="control-input" id="infographicBgZoom" min="50" max="300" value="100"> </div>
                    <div class="control-group"> <label>Position X (px)</label> <input type="number" class="control-input" id="infographicBgPosX" value="0" step="5"> </div>
                    <div class="control-group"> <label>Position Y (px)</label> <input type="number" class="control-input" id="infographicBgPosY" value="0" step="5"> </div>
                </div>

                <div class="control-group" style="padding-top: 10px; border-top: 1px solid var(--subtle-border);">
                    <h4>Global Branding Overlay</h4>
                    <h6>Logo Settings</h6>
                    <div class="control-group"> <label><input type="checkbox" id="brandLogoOnImageEnable" class="control-input" style="width:auto; margin-right: 5px;"> Add Logo Overlay</label> </div>
                    <div class="control-group"> <label>Logo URL</label> <input type="url" class="control-input" id="brandLogoOnImageLogoUrl" placeholder="https://placehold.co/100x30/transparent/ffffff?text=LOGO"> </div>
                    <div class="control-group"> <label>Upload Logo</label> <input type="file" class="control-input" id="brandLogoOnImageLogoUpload" accept="image/*"></div>
                    <div class="control-group"> <label>Logo Position</label> 
                        <select class="control-input" id="brandLogoOnImagePosition">
                            <option value="bottom-left" selected>Bottom Left</option> <option value="bottom-right">Bottom Right</option> <option value="top-left">Top Left</option> <option value="top-right">Top Right</option> <option value="center">Center</option>
                        </select>
                    </div>
                    <div class="control-group"> <label>Logo Height (px)</label> <input type="number" class="control-input" id="brandLogoOnImageLogoHeight" value="25" min="10" max="100"> </div>
                    <h6>Text (e.g. Website) Settings</h6>
                    <div class="control-group"> <label><input type="checkbox" id="brandTextOnImageEnable" class="control-input" style="width:auto; margin-right: 5px;"> Add Text Overlay</label> </div>
                    <div class="control-group"> <label>Brand Text</label> <input type="text" class="control-input" id="brandTextOnImageText" value="MyCreativeSite.com"> </div>
                    <div class="control-group"> <label>Text Position</label> 
                        <select class="control-input" id="brandTextOnImagePosition">
                            <option value="bottom-right" selected>Bottom Right</option><option value="bottom-left">Bottom Left</option> <option value="top-left">Top Left</option> <option value="top-right">Top Right</option> <option value="center">Center</option>
                        </select>
                    </div>
                    <div class="control-group"> <label>Text Color</label> <input type="color" class="control-input" id="brandTextOnImageTextColor" value="#FFFFFF"> </div>
                    <div class="control-group"> <label>Text Size (px)</label> <input type="number" class="control-input" id="brandTextOnImageTextSize" value="12" min="6" max="30"> </div>
                </div>

            </div>
            <div class="sidebar-footer">
                <div class="action-buttons-container">
                    <button class="btn btn-primary" onclick="generateInfographic(true)"> <i class="fas fa-sync-alt"></i> Refresh </button> 
                    <button class="btn btn-primary" onclick="downloadInfographic()"> <i class="fas fa-download"></i> Download </button>
                </div>
                <div class="footer-note-container">
                    <p class="footer-note" id="footerNoteText">© 2025 Avinash Vagarnal AI Creatives. All Rights Reserved. For demonstration purposes only.</p>
                </div>
            </div>
        </div>
        <div class="main-content-wrapper">
            <div class="main-content">
                <div class="canvas-area" id="canvasArea">
                    <div class="infographic" id="infographicCanvas">
                        <h1 style="text-align: center; margin: 50px; font-weight: 800; color: #2c3e50;">Loading Infographic...</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Helper Functions ---
        const uploadedImageCache = {};
        function parseCSV(str) { if (!str || typeof str !== 'string') return []; return str.split(',').map(item => item.trim()).filter(item => item !== ""); }
        function getElementValue(id, defaultValue = '') { const element = document.getElementById(id); if (!element) return defaultValue; if (element.type === 'checkbox') return element.checked; if (element.type === 'file') { if (element.files && element.files[0] && uploadedImageCache[id]) { return uploadedImageCache[id]; } else if (uploadedImageCache[id] && (!element.files || element.files.length === 0)) { return uploadedImageCache[id]; } else if (element.files && element.files.length === 0 && element.dataset.lastUrl) { return element.dataset.lastUrl; } } return element.value !== "" ? element.value : defaultValue; }
        function getElementIntValue(id, defaultValue = 0) { const val = getElementValue(id, defaultValue.toString()); if (typeof val === 'boolean') return val ? 1 : 0; const parsed = parseInt(val); return isNaN(parsed) ? defaultValue : parsed; }
        function getElementFloatValue(elementIdOrValue, defaultValue = 0.0) { let valStr; if (typeof elementIdOrValue === 'string' && document.getElementById(elementIdOrValue)) { valStr = document.getElementById(elementIdOrValue).value; } else { valStr = String(elementIdOrValue); } if (valStr === null || typeof valStr === 'undefined' || valStr.trim() === "" || valStr.toLowerCase() === "undefined") return defaultValue; const floatVal = parseFloat(valStr.trim()); return isNaN(floatVal) ? defaultValue : floatVal; }
        function sanitizeHTML(text) { if (typeof text !== 'string') text = String(text); const temp = document.createElement('div'); temp.textContent = text; return temp.innerHTML; }
        function shadeHexColor(hex, percent) { hex = String(hex).replace(/^#/, ''); if (hex.length === 3) hex = hex.split('').map(char => char + char).join(''); if (hex.length !== 6) return '#' + hex; let R = parseInt(hex.substring(0, 2), 16), G = parseInt(hex.substring(2, 4), 16), B = parseInt(hex.substring(4, 6), 16); R = parseInt(R * (1 + percent)); G = parseInt(G * (1 + percent)); B = parseInt(B * (1 + percent)); R = Math.min(255, Math.max(0, R)); G = Math.min(255, Math.max(0, G)); B = Math.min(255, Math.max(0, B)); return "#" + R.toString(16).padStart(2, '0') + G.toString(16).padStart(2, '0') + B.toString(16).padStart(2, '0'); }
        function handleImageUpload(event, cacheKey, urlInputId) { const file = event.target.files[0]; const urlInput = document.getElementById(urlInputId); if (file) { const reader = new FileReader(); reader.onload = (e) => { uploadedImageCache[cacheKey] = e.target.result; if (urlInput) { urlInput.dataset.lastUrl = urlInput.value; urlInput.value = ''; } generateInfographic(); }; reader.readAsDataURL(file); } else { delete uploadedImageCache[cacheKey]; generateInfographic(); } }
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } return array; }
        
        // --- Global Style Getters ---
        function getGlobalFontStyles() { return { sectionTitleFontSize: getElementValue('globalSectionTitleFontSize', '28') + 'px', headerFontSize: getElementValue('globalHeaderFontSize', '20') + 'px', paragraphFontSize: getElementValue('globalParagraphFontSize', '14') + 'px', smallTextFontSize: getElementValue('globalSmallTextFontSize', '11') + 'px' }; }
        function getGlobalLayoutStyles() { return { sectionTitleMarginBottom: getElementValue('globalSectionTitleMarginBottom', '20') + 'px', headerMarginBottom: getElementValue('globalHeaderMarginBottom', '10') + 'px', subHeaderMarginBottom: getElementValue('globalSubHeaderMarginBottom', '8') + 'px', paragraphLineHeight: getElementValue('globalParagraphLineHeight', '1.6') }; }
        
        // --- State Variables ---
        let currentTab = 'social';
        let barChartInstance = null;
        let pieChartInstance = null;
        let shuffledThemeColors = [];
        let debounceTimer;

        function fitCanvasToContainer() {
            const canvas = document.getElementById('infographicCanvas');
            const container = document.getElementById('canvasArea');
            if (!canvas || !container) return;

            const containerWidth = container.clientWidth - 40; 
            const containerHeight = container.clientHeight - 40;
            const canvasWidth = getElementIntValue('canvasWidth', 1080);
            const canvasHeight = getElementIntValue('canvasHeight', 1080);

            if (canvasWidth <= 0 || canvasHeight <= 0) return;

            const scaleX = containerWidth / canvasWidth;
            const scaleY = containerHeight / canvasHeight;
            const scale = Math.min(scaleX, scaleY, 1);

            canvas.style.transform = `scale(${scale})`;
        }
        
        // --- Event Listeners Setup ---
        function attachAllListeners() {
            document.querySelectorAll('.sidebar .tab-buttons .tab-btn:not(.preset-btn)').forEach(btn => { btn.addEventListener('click', () => { document.querySelectorAll('.sidebar .tab-buttons .tab-btn:not(.preset-btn)').forEach(b => b.classList.remove('active')); document.querySelectorAll('.sidebar .tab-content').forEach(c => c.classList.remove('active')); btn.classList.add('active'); const tabContentElement = document.getElementById(btn.dataset.tab); if (tabContentElement) tabContentElement.classList.add('active'); currentTab = btn.dataset.tab; if (currentTab === 'informational') { buildInfoBlockControls(); attachDynamicListeners(); } generateInfographic(); }); });
            document.querySelectorAll('#canvasPresetButtons .preset-btn').forEach(btn => { btn.addEventListener('click', (e) => { document.querySelectorAll('#canvasPresetButtons .preset-btn').forEach(b => b.classList.remove('active')); e.currentTarget.classList.add('active'); document.getElementById('canvasWidth').value = e.currentTarget.dataset.width; document.getElementById('canvasHeight').value = e.currentTarget.dataset.height; generateInfographic(); }); });
            document.querySelectorAll('#bgPresetGrid .bg-swatch').forEach(swatch => { swatch.addEventListener('click', (e) => { const bgValue = e.currentTarget.dataset.bg; const bgTypeSelect = document.getElementById('infographicBackgroundType'); document.querySelectorAll('#bgPresetGrid .bg-swatch').forEach(s => s.classList.remove('active')); e.currentTarget.classList.add('active'); bgTypeSelect.value = 'solid'; document.getElementById('infographicBackgroundImageControl').style.display = 'none'; generateInfographic(); }); });
            
            document.querySelectorAll('.control-input').forEach(el => {
                const eventType = el.type === 'checkbox' || el.tagName === 'SELECT' || el.type === 'color' || el.type === 'range' ? 'change' : 'input';
                el.addEventListener(eventType, () => {
                    if (el.id === 'infographicBackgroundType') {
                        document.getElementById('infographicBackgroundImageControl').style.display = el.value === 'image' ? 'block' : 'none';
                    } else if (el.id === 'tableDataFormat') {
                        toggleTableFormatOptions();
                    } else if (el.id === 'infoBlockCount') {
                        buildInfoBlockControls();
                        attachDynamicListeners();
                    } else if (el.id === 'themeToggle') {
                        document.body.classList.toggle('dark-theme', el.checked);
                    }
                    generateInfographic(el.id === 'themeToggle');
                });
            });

            document.querySelectorAll('input[type="file"].control-input').forEach(fileInput => {
                const urlInputId = fileInput.id.replace('Upload', 'Url');
                fileInput.addEventListener('change', (event) => handleImageUpload(event, fileInput.id, urlInputId));
            });
        }

        // --- Core Rendering Logic (with Debounce) ---
        function generateInfographic(isManualClick = false) {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                _renderInfographic(isManualClick);
            }, isManualClick ? 0 : 250); 
        }
        
        function _renderInfographic(isManualClick) {
            try {
                const infographicDiv = document.getElementById('infographicCanvas');
                if (!infographicDiv) return;
                
                infographicDiv.innerHTML = '';
                infographicDiv.style.background = '';
                infographicDiv.style.backgroundImage = '';
                
                const canvasWidth = getElementIntValue('canvasWidth', 1080);
                const canvasHeight = getElementIntValue('canvasHeight', 1080);
                infographicDiv.style.width = `${canvasWidth}px`;
                infographicDiv.style.height = `${canvasHeight}px`;
                infographicDiv.className = 'infographic';

                const infographicBgType = getElementValue('infographicBackgroundType', 'solid');
                const activeSwatch = document.querySelector('.bg-swatch.active');
                
                const isDark = document.body.classList.contains('dark-theme');
                infographicDiv.style.background = isDark ? '#1a1d2e' : '#ffffff';

                if (activeSwatch && infographicBgType === 'solid') {
                    infographicDiv.style.background = activeSwatch.dataset.bg;
                } else if (infographicBgType === 'image') {
                    let infographicBgImgSrc = getElementValue('infographicBackgroundImageUpload') || getElementValue('infographicBackgroundImageUrl');
                    if (infographicBgImgSrc) {
                        infographicDiv.style.backgroundImage = `url(${sanitizeHTML(infographicBgImgSrc)})`;
                        infographicDiv.style.backgroundSize = `${getElementValue('infographicBgZoom', '100')}%`;
                        infographicDiv.style.backgroundPosition = `${getElementValue('infographicBgPosX', '0')}px ${getElementValue('infographicBgPosY', '0')}px`;
                    }
                } else if (infographicBgType === 'transparent') {
                    infographicDiv.style.backgroundColor = 'transparent';
                }

                const rootStyle = document.documentElement.style;
                const primaryColorValue = getElementValue('primaryColor', '#667eea');
                rootStyle.setProperty('--primary', primaryColorValue);
                rootStyle.setProperty('--secondary', getElementValue('secondaryColor', '#764ba2'));
                rootStyle.setProperty('--accent', getElementValue('accentColor', '#f093fb'));
                const globalSectionHeaderColorValue = getElementValue('globalSectionTitleColor', primaryColorValue);
                if (globalSectionHeaderColorValue === primaryColorValue) {
                    rootStyle.setProperty('--global-section-header-color', 'linear-gradient(135deg, var(--primary), var(--secondary))');
                } else {
                    rootStyle.setProperty('--global-section-header-color', globalSectionHeaderColorValue);
                }
                rootStyle.setProperty('--global-header-color', getElementValue('globalHeaderColor', '#764ba2'));
                rootStyle.setProperty('--global-paragraph-color', getElementValue('globalParagraphColor', '#2c3e50'));
                infographicDiv.style.fontWeight = getElementValue('fontWeight', '400');
                
                if (isManualClick) {
                    const themeColors = [ getComputedStyle(document.documentElement).getPropertyValue('--primary').trim(), getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim(), getComputedStyle(document.documentElement).getPropertyValue('--accent').trim(), getComputedStyle(document.documentElement).getPropertyValue('--success').trim(), getComputedStyle(document.documentElement).getPropertyValue('--warning').trim(), getComputedStyle(document.documentElement).getPropertyValue('--danger').trim() ];
                    shuffledThemeColors = shuffleArray([...themeColors]);
                }

                drawCurrentInfographicType(infographicDiv);
                applyGlobalBranding(infographicDiv);
                fitCanvasToContainer();
            } catch (error) {
                console.error("Error during _renderInfographic:", error);
                const infographicDiv = document.getElementById('infographicCanvas');
                if (infographicDiv) infographicDiv.innerHTML = `<p style="color:red; padding:20px; text-align:center;">Error rendering infographic. Check console for details. <br>Error: ${sanitizeHTML(error.message)}</p>`;
            }
        }
        
        function drawCurrentInfographicType(canvas) {
            const fontStyles = getGlobalFontStyles();
            const layoutStyles = getGlobalLayoutStyles();
            const padding = getElementValue('globalContentPadding', '20') + 'px';
            canvas.innerHTML = '';
            
            if (currentTab === 'social') {
                generateSocialInfographic(canvas, fontStyles, layoutStyles);
                return;
            }
            if (currentTab === 'comingUp') {
                generateComingUpInfographic(canvas, fontStyles, layoutStyles, padding);
                return;
            }
            
            canvas.innerHTML = `<div class="infographic-content" style="padding: ${padding};"></div>`;
            const contentDiv = canvas.querySelector('.infographic-content');

            switch (currentTab) {
                case 'process': generateProcessInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'statistical': generateStatisticalInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'textToTable': generateTableInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'informational': generateInformationalInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'timeline': generateTimelineInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'barChart': generateBarChartInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'pieChart': generatePieChartInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'dams': generateDamInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'prices': generatePriceInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'comparison': generateComparisonInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'hierarchical': generateHierarchicalInfographic(contentDiv, fontStyles, layoutStyles); break;
                case 'list': generateListInfographic(contentDiv, fontStyles, layoutStyles); break;
                default:
                    contentDiv.innerHTML = `<h1 class="section-title" style="font-size: ${fontStyles.sectionTitleFontSize};">Select an Infographic Type</h1>`;
            }
        }

        function createSectionTitle(title, f, l) {
            if (!title) return '';
            const isGradient = getComputedStyle(document.documentElement).getPropertyValue('--global-section-header-color').includes('gradient');
            const colorStyle = isGradient 
                ? `background: var(--global-section-header-color); -webkit-background-clip: text; -webkit-text-fill-color: transparent;`
                : `color: var(--global-section-header-color);`;
            return `<h1 class="section-title" style="font-size: ${f.sectionTitleFontSize}; margin-bottom: ${l.sectionTitleMarginBottom}; ${colorStyle}">${sanitizeHTML(title)}</h1>`;
        }
        
        // --- Infographic Generation Functions (All Implemented) ---
        function generateSocialInfographic(canvas, f, l) {
            canvas.classList.add('social-post-infographic');
            let imgSrc = getElementValue('socialImageUpload') || getElementValue('socialImageUrl');
            if (imgSrc) {
                canvas.style.backgroundImage = `url(${sanitizeHTML(imgSrc)})`;
                canvas.style.backgroundSize = `${getElementValue('socialBgZoom', '100')}%`;
                canvas.style.backgroundPosition = `${getElementValue('socialBgPosX', '0')}px ${getElementValue('socialBgPosY', '0')}px`;
            } else {
                canvas.style.backgroundImage = 'none';
            }
            canvas.style.setProperty('--overlay-color', getElementValue('socialOverlayColor', '#000000'));
            canvas.style.setProperty('--overlay-opacity', getElementValue('socialOverlayOpacity', '0.4'));
            
            const header = getElementValue('socialHeader', 'Header');
            const headerColor = getElementValue('socialHeaderTextColor', '#FFFFFF');
            const infoText = getElementValue('socialInfoText', 'Some text here.');
            const infoTextColor = getElementValue('socialInfoTextColor', '#FFFFFF');
            const hasShadow = getElementValue('socialTextShadow');
            
            const headerStyle = `font-size: ${getElementValue('socialHeaderFontSize', 42)}px; color: ${headerColor}; left: ${getElementValue('socialHeaderPosX', 40)}px; top: ${getElementValue('socialHeaderPosY', 400)}px;`;
            const infoTextStyle = `font-size: ${getElementValue('socialInfoTextFontSize', 24)}px; color: ${infoTextColor}; left: ${getElementValue('socialInfoTextPosX', 40)}px; top: ${getElementValue('socialInfoTextPosY', 500)}px;`;
            
            const textContentClass = hasShadow ? 'text-content-area text-has-shadow' : 'text-content-area';
            
            canvas.innerHTML = `
                <div class="${textContentClass}">
                    <div class="header" style="${headerStyle}">${sanitizeHTML(header)}</div>
                    <p class="info-text" style="${infoTextStyle}">${sanitizeHTML(infoText).replace(/\n/g, '<br>')}</p>
                </div>`;
        }

        function generateProcessInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('processSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            const titles = parseCSV(getElementValue('processStepTitlesCSV'));
            const descs = parseCSV(getElementValue('processStepDescsCSV'));
            const icons = parseCSV(getElementValue('processStepIconsCSV'));
            const maxItems = Math.max(titles.length, descs.length, icons.length);

            if (maxItems > 0) {
                for(let i = 0; i < maxItems; i++) {
                    const title = sanitizeHTML(titles[i] || `Step ${i + 1}`);
                    const desc = sanitizeHTML(descs[i] || 'Description missing.');
                    const iconRaw = icons[i] || (i + 1);
                    const icon = (iconRaw.startsWith('fa-') || iconRaw.startsWith('fas ')) ? `<i class="${sanitizeHTML(iconRaw)}"></i>` : sanitizeHTML(iconRaw);

                    html += `
                        <div class="process-step">
                            <div class="step-number">${icon}</div>
                            <div class="step-content">
                                <h3 style="font-size: ${f.headerFontSize}; margin-bottom: ${l.subHeaderMarginBottom};">${title}</h3>
                                <p style="font-size: ${f.paragraphFontSize}; line-height: ${l.paragraphLineHeight};">${desc}</p>
                            </div>
                        </div>`;
                }
            }
            contentDiv.innerHTML = html;
        }

        function generateStatisticalInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('statSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            const values = parseCSV(getElementValue('statValuesCSV'));
            const labels = parseCSV(getElementValue('statLabelsCSV'));
            const maxItems = Math.max(values.length, labels.length);

            if (maxItems > 0) {
                html += '<div class="stat-grid">';
                for(let i = 0; i < maxItems; i++) {
                    const value = sanitizeHTML(values[i] || 'N/A');
                    const label = sanitizeHTML(labels[i] || 'Label missing');
                    const valueFontSize = (value.length > 8) ? `${parseFloat(f.sectionTitleFontSize) * 0.7}px` : f.sectionTitleFontSize;

                    html += `
                        <div class="stat-card">
                            <div class="stat-number" style="font-size: ${valueFontSize};">${value}</div>
                            <div class="stat-label" style="font-size: ${f.paragraphFontSize};">${label}</div>
                        </div>`;
                }
                html += '</div>';
            }
            contentDiv.innerHTML = html;
        }
        
        function generateTableInfographic(contentDiv, f, l){const title=getElementValue('tableSectionTitle','Data Table');let html=createSectionTitle(title,f,l);const inputText=document.getElementById('tableInputText').value.trim(),dataFormat=document.getElementById('tableDataFormat').value;if(!inputText){html+=`<p style="text-align:center; font-size: ${f.paragraphFontSize};">Paste data to generate a table.</p>`;contentDiv.innerHTML=html;return}const headerBg=getElementValue('tableHeaderBgColor','#f2f2f2'),headerText=getElementValue('tableHeaderTextColor','#333333'),oddRowBg=getElementValue('tableOddRowBgColor','#ffffff'),evenRowBg=getElementValue('tableEvenRowBgColor','#f9f9f9'),borderColor=getElementValue('tableBorderColor','#dddddd'),bodyTextColor=getElementValue('tableBodyTextColor','#333333');try{let tableContentHTML='';if(dataFormat==='vertical'){tableContentHTML=generateVerticalTableContent(inputText)}else{tableContentHTML=generateTabularTableContent(inputText)}html+=`<div class="generated-table-wrapper"><table class="generated-table" style="border: 1px solid ${borderColor}; font-size: ${f.paragraphFontSize};">${tableContentHTML}</table></div>`}catch(e){html+=`<p style="text-align:center; color:red; font-size: ${f.paragraphFontSize};">${sanitizeHTML(e.message)}</p>`}contentDiv.innerHTML=html;const tableEl=contentDiv.querySelector('.generated-table');if(tableEl){tableEl.querySelectorAll('th').forEach(th=>{th.style.backgroundColor=headerBg;th.style.color=headerText;th.style.border=`1px solid ${borderColor}`});tableEl.querySelectorAll('tbody tr').forEach((row,index)=>{row.style.backgroundColor=(index%2===0)?oddRowBg:evenRowBg;row.querySelectorAll('td').forEach(cell=>{cell.style.border=`1px solid ${borderColor}`;cell.style.color=bodyTextColor})})}}
        function generateVerticalTableContent(text){const separator=document.getElementById('tableFieldSeparator').value;const records=text.split(/\n\s*\n/).filter(r=>r.trim());if(records.length===0)throw new Error("No data blocks found in vertical format.");const headers=records[0].trim().split('\n').map(line=>{const parts=line.split(separator);return parts.length>=2?parts[0].trim():null}).filter(Boolean);if(headers.length===0)throw new Error("Could not determine headers from the first block.");let html='<thead><tr>';headers.forEach(h=>{html+=`<th>${sanitizeHTML(h)}</th>`});html+='</tr></thead><tbody>';records.forEach(record=>{const lines=record.trim().split('\n');const recordMap=new Map();lines.forEach(line=>{const parts=line.split(separator);if(parts.length>=2){recordMap.set(parts[0].trim(),parts.slice(1).join(separator).trim())}});html+='<tr>';headers.forEach(h=>{html+=`<td>${sanitizeHTML(recordMap.get(h)||"")}</td>`});html+='</tr>'});html+='</tbody>';return html}
        function generateTabularTableContent(text){const separator=document.getElementById('tableSeparator').value.replace(/\\t/g,'\t');const hasHeader=document.getElementById('tableHasHeader').checked;const lines=text.split('\n').filter(l=>l.trim());if(lines.length===0)throw new Error("No valid data found in tabular format.");let html='';if(hasHeader&&lines.length>0){const headerCells=lines.shift().split(separator);html+='<thead><tr>';headerCells.forEach(cell=>{html+=`<th>${sanitizeHTML(cell.trim())}</th>`});html+='</tr></thead>'}html+='<tbody>';lines.forEach(line=>{const cells=line.split(separator);html+='<tr>';cells.forEach(cell=>{html+=`<td>${sanitizeHTML(cell.trim())}</td>`});html+='</tr>'});html+='</tbody>';return html}

        function generateInformationalInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('infoSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            const blockCount = getElementIntValue('infoBlockCount', 1);

            for (let i = 1; i <= blockCount; i++) {
                const title = sanitizeHTML(getElementValue(`infoBlock${i}Title`, `Header ${i}`));
                const content = sanitizeHTML(getElementValue(`infoBlock${i}Content`, `Content for block ${i}.`)).replace(/\n/g, '<br>');
                const imageUrl = getElementValue(`infoBlock${i}ImageUpload`) || getElementValue(`infoBlock${i}ImageUrl`);
                const imagePos = getElementValue(`infoBlock${i}ImagePos`, 'none');
                const imageSize = getElementValue(`infoBlock${i}ImageSize`, 'medium');
                
                let imageHtml = '';
                if (imageUrl && imagePos !== 'none') {
                    imageHtml = `
                        <div class="info-block-image-container size-${imageSize}">
                            <img src="${sanitizeHTML(imageUrl)}" alt="${title}">
                        </div>`;
                }

                html += `
                    <div class="info-block-item ${imagePos !== 'none' ? 'image-' + imagePos : ''}">
                        ${imageHtml}
                        <div class="info-block-text">
                            <h2 style="font-size: ${f.headerFontSize}; margin-bottom: ${l.headerMarginBottom};">${title}</h2>
                            <p style="font-size: ${f.paragraphFontSize}; line-height: ${l.paragraphLineHeight};">${content}</p>
                        </div>
                    </div>`;
            }
            contentDiv.innerHTML = html;
        }

        function generateTimelineInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('timelineSectionTitle');
            const layout = getElementValue('timelineLayoutType', 'vertical');
            let html = createSectionTitle(sectionTitle, f, l);

            const dates = parseCSV(getElementValue('timelineEventDatesCSV'));
            const titles = parseCSV(getElementValue('timelineEventTitlesCSV'));
            const descs = parseCSV(getElementValue('timelineEventDescsCSV'));
            const maxItems = Math.max(dates.length, titles.length, descs.length);

            if (maxItems === 0) {
                contentDiv.innerHTML = html;
                return;
            }

            if (layout === 'vertical') {
                html += '<div class="timeline-vertical-container">';
                for (let i = 0; i < maxItems; i++) {
                    html += `
                        <div class="timeline-vertical-item">
                            <div class="timeline-vertical-dot"></div>
                            <div class="timeline-vertical-content">
                                <h3 style="font-size:${f.smallTextFontSize};">${sanitizeHTML(dates[i] || '')}</h3>
                                <h4 style="font-size:${f.headerFontSize}; margin-bottom:${l.subHeaderMarginBottom};">${sanitizeHTML(titles[i] || 'Event Title')}</h4>
                                <p style="font-size:${f.paragraphFontSize}; line-height:${l.paragraphLineHeight};">${sanitizeHTML(descs[i] || 'Event description.')}</p>
                            </div>
                        </div>`;
                }
                html += '</div>';
            } else { // Horizontal
                html += '<div class="timeline-horizontal-wrapper"><div class="timeline-horizontal-container"><div class="timeline-horizontal-line"></div><div class="timeline-horizontal-events">';
                for (let i = 0; i < maxItems; i++) {
                    html += `
                        <div class="timeline-horizontal-item">
                             <div class="timeline-horizontal-dot"></div>
                             <div class="timeline-horizontal-content">
                                <h3 style="font-size:${f.smallTextFontSize};">${sanitizeHTML(dates[i] || '')}</h3>
                                <h4 style="font-size:${Math.max(12, parseFloat(f.paragraphFontSize))}px; margin-bottom:${l.subHeaderMarginBottom};">${sanitizeHTML(titles[i] || 'Event')}</h4>
                                <p style="font-size:${Math.max(10, parseFloat(f.smallTextFontSize))}px; line-height:${l.paragraphLineHeight};">${sanitizeHTML(descs[i] || 'Desc.')}</p>
                            </div>
                        </div>`;
                }
                html += '</div></div></div>';
            }
            contentDiv.innerHTML = html;
        }

        function generateBarChartInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('barChartSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            const chartTitle = sanitizeHTML(getElementValue('barChartTitle', 'Bar Chart'));
            const chartHeight = getElementIntValue('barChartHeight', 250);
            const labels = parseCSV(getElementValue('barChartLabelsCSV'));
            const data = parseCSV(getElementValue('barChartDataCSV')).map(Number);
            const chartId = 'barChartCanvas';
            
            html += `
                <div class="chart-container">
                    <h3 class="chart-title" style="font-size: ${f.headerFontSize};">${chartTitle}</h3>
                    <div class="chart-canvas-wrapper" style="height: ${chartHeight}px;">
                        <canvas id="${chartId}"></canvas>
                    </div>
                </div>`;
            contentDiv.innerHTML = html;
            createBarChart(chartId, labels, data, chartTitle);
        }

        function generatePieChartInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('pieChartSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            const chartTitle = sanitizeHTML(getElementValue('pieChartUserTitle', 'Pie Chart'));
            const chartHeight = getElementIntValue('pieChartHeight', 250);
            const labels = parseCSV(getElementValue('pieChartLabelsCSV'));
            const data = parseCSV(getElementValue('pieChartDataCSV')).map(Number);
            const chartId = 'pieChartCanvas';

            html += `
                <div class="chart-container">
                    <h3 class="chart-title" style="font-size: ${f.headerFontSize};">${chartTitle}</h3>
                    <div class="chart-canvas-wrapper" style="height: ${chartHeight}px;">
                        <canvas id="${chartId}"></canvas>
                    </div>
                </div>`;
            contentDiv.innerHTML = html;
            createPieChart(chartId, labels, data, chartTitle);
        }

        function generateComparisonInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('compareSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            html += '<div class="comparison-grid">';

            for(let i = 1; i <= 2; i++) {
                const title = sanitizeHTML(getElementValue(`compareItem${i}Title`, `Item ${i}`));
                const price = sanitizeHTML(getElementValue(`compareItem${i}Price`, `Price ${i}`));
                const features = parseCSV(getElementValue(`compareItem${i}FeaturesCSV`));
                
                let featuresHtml = '<ul>';
                features.forEach(feature => {
                    featuresHtml += `<li style="font-size: ${f.paragraphFontSize};"><i class="fas fa-check-circle"></i> ${sanitizeHTML(feature)}</li>`;
                });
                featuresHtml += '</ul>';

                html += `
                    <div class="comparison-card">
                        <h3 style="font-size: ${f.headerFontSize}; margin-bottom:${l.headerMarginBottom};">${title}</h3>
                        <div class="price" style="font-size: ${f.paragraphFontSize};">${price}</div>
                        ${featuresHtml}
                    </div>`;
            }
            html += '</div>';
            contentDiv.innerHTML = html;
        }

        function generateHierarchicalInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('hierarchySectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);

            const l1Title = sanitizeHTML(getElementValue('hierarchyL1Title', 'Parent'));
            const l1Desc = sanitizeHTML(getElementValue('hierarchyL1Desc', 'Description'));
            const l2Titles = parseCSV(getElementValue('hierarchyL2TitlesCSV'));
            const l2Descs = parseCSV(getElementValue('hierarchyL2DescsCSV'));
            
            html += '<div class="hierarchy-container">';
            html += `<div class="hierarchy-node" style="min-width: 180px;">
                        <h4 style="font-size:${f.headerFontSize};">${l1Title}</h4>
                        <p style="font-size:${f.paragraphFontSize};">${l1Desc}</p>
                     </div>`;

            if (l2Titles.length > 0) {
                html += '<div class="hierarchy-connector"></div>';
                html += '<div class="hierarchy-children">';
                for(let i = 0; i < l2Titles.length; i++) {
                    const l2Title = sanitizeHTML(l2Titles[i]);
                    const l2Desc = sanitizeHTML(l2Descs[i] || 'Description');
                     html += `<div class="hierarchy-node" style="background: var(--secondary);">
                                <h4 style="font-size:${f.headerFontSize};">${l2Title}</h4>
                                <p style="font-size:${f.paragraphFontSize};">${l2Desc}</p>
                              </div>`;
                }
                html += '</div>';
            }
            html += '</div>';
            contentDiv.innerHTML = html;
        }

        function generateListInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('listSectionTitle');
            let html = createSectionTitle(sectionTitle, f, l);
            const titles = parseCSV(getElementValue('listItemTitlesCSV'));
            const descs = parseCSV(getElementValue('listItemDescsCSV'));
            const icons = parseCSV(getElementValue('listItemIconsCSV'));
            const maxItems = Math.max(titles.length, descs.length);

            if (maxItems > 0) {
                for(let i = 0; i < maxItems; i++) {
                    const title = sanitizeHTML(titles[i] || `Item ${i + 1}`);
                    const desc = sanitizeHTML(descs[i] || 'Description missing.');
                    const iconRaw = icons[i] || 'fas fa-check';
                    const icon = `<i class="${sanitizeHTML(iconRaw)}"></i>`;

                    html += `
                        <div class="list-infographic-item">
                            <div class="icon">${icon}</div>
                            <div class="text-content">
                                <h4 style="font-size: ${f.headerFontSize}; margin-bottom: ${l.subHeaderMarginBottom};">${title}</h4>
                                <p style="font-size: ${f.paragraphFontSize}; line-height: ${l.paragraphLineHeight};">${desc}</p>
                            </div>
                        </div>`;
                }
            }
            contentDiv.innerHTML = html;
        }
        
        function generateComingUpInfographic(canvas, f, l, padding) {
            canvas.classList.add('coming-up-infographic');
            const position = getElementValue('comingUpImagePosition', 'top');
            const imageUrl = getElementValue('comingUpImageUpload') || getElementValue('comingUpImageUrl');
            
            const header = sanitizeHTML(getElementValue('comingUpHeader', 'Event'));
            const subHeader = sanitizeHTML(getElementValue('comingUpSubHeader', 'Coming Soon'));
            const infoText = sanitizeHTML(getElementValue('comingUpInfoText', 'Details here.')).replace(/\n/g, '<br>');
            const date = sanitizeHTML(getElementValue('comingUpDate', 'Date'));
            const time = sanitizeHTML(getElementValue('comingUpTime', 'Time'));

            let imageHtml = '';
            if (imageUrl) {
                imageHtml = `<div class="image-container"><img src="${imageUrl}" class="main-image" alt="${header}"></div>`;
            }

            const textHtml = `
                <div class="text-content-area">
                    <h1 class="header" style="font-size:${f.sectionTitleFontSize}; margin-bottom:${l.headerMarginBottom};">${header}</h1>
                    <h2 class="sub-header" style="font-size:${f.headerFontSize}; margin-bottom:${l.headerMarginBottom};">${subHeader}</h2>
                    <p class="info-text" style="font-size:${f.paragraphFontSize}; line-height:${l.paragraphLineHeight}; margin-bottom: 20px;">${infoText}</p>
                    <div class="date-time" style="font-size:${f.paragraphFontSize};">${date} &bull; ${time}</div>
                </div>`;
            
            if (position === 'background') {
                if (imageUrl) {
                    canvas.style.backgroundImage = `url(${imageUrl})`;
                    canvas.style.backgroundSize = 'cover';
                    canvas.style.backgroundPosition = 'center';
                    canvas.style.color = '#fff';
                    canvas.style.textShadow = '1px 1px 5px rgba(0,0,0,0.5)';
                }
                canvas.innerHTML = `<div class="infographic-content" style="background: rgba(0,0,0,0.4); padding: ${padding};">${textHtml}</div>`;
            } else {
                canvas.style.backgroundImage = '';
                canvas.style.color = 'var(--text-color)';
                canvas.style.textShadow = 'none';

                let contentHtml = '';
                if (position === 'top') contentHtml = imageHtml + textHtml;
                else if (position === 'bottom') contentHtml = textHtml + imageHtml;
                else if (position === 'left') {
                    canvas.classList.add('layout-image-left');
                    canvas.style.flexDirection = 'row';
                    contentHtml = imageHtml + textHtml;
                } else if (position === 'right') {
                    canvas.classList.add('layout-image-right');
                    canvas.style.flexDirection = 'row-reverse';
                    contentHtml = imageHtml + textHtml;
                }
                canvas.innerHTML = `<div class="infographic-content" style="padding: ${padding};">${contentHtml}</div>`;
            }
        }
        
        function createBarChart(canvasId, labels, data, label) {
            const ctx = document.getElementById(canvasId)?.getContext('2d');
            if (ctx) {
                if (barChartInstance) barChartInstance.destroy();
                const isDark = document.body.classList.contains('dark-theme');
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#e1e9f1' : '#2c3e50';
                const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim();
                const secondaryColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim();
                const legendPos = getElementValue('barChartLegendPos', 'bottom');
                const legendFontSize = getElementIntValue('barChartLegendFontSize', 12);
                Chart.defaults.color = textColor;
                barChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: data.map((d, i) => i % 2 === 0 ? primaryColor + 'CC' : secondaryColor + 'CC'),
                            borderColor: data.map((d, i) => i % 2 === 0 ? primaryColor : secondaryColor),
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true, grid: { color: gridColor } }, x: { grid: { color: gridColor } } },
                        plugins: { 
                            legend: { 
                                display: legendPos !== 'hidden', 
                                position: legendPos,
                                labels: { font: { size: legendFontSize } }
                            } 
                        }
                    }
                });
            }
        }
        function createPieChart(canvasId, labels, data, label) {
            const ctx = document.getElementById(canvasId)?.getContext('2d');
            if (ctx) {
                if (pieChartInstance) pieChartInstance.destroy();
                const isDark = document.body.classList.contains('dark-theme');
                const textColor = isDark ? '#e1e9f1' : '#2c3e50';
                const rootStyles = getComputedStyle(document.documentElement);
                const legendPos = getElementValue('pieChartLegendPos', 'bottom');
                const legendFontSize = getElementIntValue('pieChartLegendFontSize', 12);
                const chartColors = [
                    rootStyles.getPropertyValue('--primary').trim(),
                    rootStyles.getPropertyValue('--secondary').trim(),
                    rootStyles.getPropertyValue('--accent').trim(),
                    rootStyles.getPropertyValue('--success').trim(),
                    rootStyles.getPropertyValue('--warning').trim(),
                    rootStyles.getPropertyValue('--danger').trim()
                ];
                Chart.defaults.color = textColor;
                pieChartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{ label: label, data: data, backgroundColor: chartColors, borderWidth: 1 }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: legendPos !== 'hidden', 
                                position: legendPos, 
                                labels: { 
                                    color: textColor,
                                    font: { size: legendFontSize }
                                } 
                            } 
                        }
                    }
                });
            }
        }
        function generateDamInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('damSectionTitle', 'Dam Levels');
            let html = createSectionTitle(sectionTitle, f, l);
            const cardWidth = getElementIntValue('damCardWidth', 150);
            html += `<div class="dam-grid" style="grid-template-columns: repeat(auto-fit, minmax(${cardWidth}px, 1fr));">`;
            const names = parseCSV(getElementValue('damNamesCSV'));
            const levels = parseCSV(getElementValue('damPresentLevelsCSV'));
            const capacities = parseCSV(getElementValue('damMaxCapacitiesCSV'));
            const unit = getElementValue('damUnitOfMeasure', 'TMC');
            const progressLabel = getElementValue('damProgressLabel', 'Storage');
            const levelFontSize = getElementValue('damLevelFontSize', '36');
            const maxItems = Math.max(names.length, levels.length, capacities.length);
            const colorLogic = getElementValue('damColorLogic', 'performance');
            const root = getComputedStyle(document.documentElement);
            const themeColors = [root.getPropertyValue('--success').trim(), root.getPropertyValue('--warning').trim(), root.getPropertyValue('--danger').trim(), root.getPropertyValue('--primary').trim(), root.getPropertyValue('--secondary').trim(), root.getPropertyValue('--accent').trim()];
            let colorPool = (colorLogic === 'shuffle') ? shuffledThemeColors : themeColors;
            if (maxItems > 0) {
                for (let i = 0; i < maxItems; i++) {
                    const name = sanitizeHTML(names[i] || `Dam ${i + 1}`);
                    const level = getElementFloatValue(levels[i], 0);
                    let capacity = getElementFloatValue(capacities[i], 100);
                    if (capacity <= 0) capacity = level > 0 ? level * 1.25 : 100;
                    const percentage = capacity > 0 ? Math.min(Math.max(0, Math.round((level / capacity) * 100)), 100) : 0;
                    let cardColor;
                    if (colorLogic === 'performance') {
                        cardColor = percentage > 80 ? themeColors[0] : (percentage > 50 ? themeColors[1] : themeColors[2]);
                    } else {
                        cardColor = colorPool[i % colorPool.length];
                    }
                    const gradientEnd = shadeHexColor(cardColor, -0.25);
                    html += `
                        <div class="dam-card" style="background: linear-gradient(135deg, ${cardColor}, ${gradientEnd});">
                            <div class="dam-name" style="font-size: ${f.headerFontSize}; margin-bottom: ${l.subHeaderMarginBottom};">${name}</div>
                            <div class="dam-level" style="font-size: ${levelFontSize}px; margin-bottom: ${l.headerMarginBottom};">${percentage}%</div>
                            <div class="dam-progress-bar-bg"><div class="dam-progress-bar-fg" style="width: ${percentage}%;"></div></div>
                            <div class="dam-capacity-info" style="font-size: ${f.smallTextFontSize}; line-height: ${l.paragraphLineHeight};">${level.toLocaleString(undefined, {minimumFractionDigits: (level % 1 === 0 ? 0 : 1), maximumFractionDigits: 2})} / ${capacity.toLocaleString(undefined, {minimumFractionDigits: (capacity % 1 === 0 ? 0 : 1), maximumFractionDigits: 2})} ${sanitizeHTML(unit)}</div>
                            <div class="dam-progress-label" style="font-size: ${Math.max(7, 0.9 * parseFloat(f.smallTextFontSize))}px;">${sanitizeHTML(progressLabel)}</div>
                        </div>`;
                }
            }
            html += '</div>';
            contentDiv.innerHTML = html;
        }

        function generatePriceInfographic(contentDiv, f, l) {
            const sectionTitle = getElementValue('priceSectionTitle', 'Current Rates');
            let html = createSectionTitle(sectionTitle, f, l);
            const cardWidth = getElementIntValue('priceCardWidth', 180);
            html += `<div class="price-grid" style="grid-template-columns: repeat(auto-fit, minmax(${cardWidth}px, 1fr));">`;

            const updateInfo = sanitizeHTML(getElementValue('priceUpdateLabel', 'As of today'));
            const colorLogic = getElementValue('priceColorLogic', 'default');
            const root = getComputedStyle(document.documentElement);
            const cycleColors = [root.getPropertyValue('--primary').trim(), root.getPropertyValue('--secondary').trim(), root.getPropertyValue('--accent').trim(), root.getPropertyValue('--success').trim()];
            const defaultGradients = ['linear-gradient(135deg, #FFD700, #FFA500)', 'linear-gradient(135deg, #C0C0C0, #A9A9A9)', 'linear-gradient(135deg, #CD7F32, #A0522D)'];
            
            let itemsExist = false;
            let colorIndex = 0;

            for (let i = 1; i <= 3; i++) {
                const label = sanitizeHTML(getElementValue(`priceItem${i}Label`));
                if (!label) continue;
                itemsExist = true;

                const rate = sanitizeHTML(getElementValue(`priceItem${i}Rate`, 'N/A'));
                const unit = sanitizeHTML(getElementValue(`priceItem${i}Unit`));
                let backgroundStyle;
                if (colorLogic === 'default') {
                    backgroundStyle = defaultGradients[colorIndex % defaultGradients.length];
                } else if (colorLogic === 'cycle') {
                    const color = cycleColors[colorIndex % cycleColors.length];
                    backgroundStyle = `linear-gradient(135deg, ${color}, ${shadeHexColor(color, -0.25)})`;
                } else { // shuffle
                    const color = shuffledThemeColors[colorIndex % shuffledThemeColors.length];
                    backgroundStyle = `linear-gradient(135deg, ${color}, ${shadeHexColor(color, -0.25)})`;
                }

                html += `
                    <div class="price-card" style="background: ${backgroundStyle};">
                        <div class="price-label" style="font-size: ${f.headerFontSize}; margin-bottom: ${l.subHeaderMarginBottom};">${label}</div>
                        <div class="price-value" style="font-size: ${f.sectionTitleFontSize}; margin-bottom: ${l.headerMarginBottom};">₹${rate}</div>
                        <div class="price-unit" style="font-size: ${f.smallTextFontSize};">${unit}</div>
                    </div>`;
                colorIndex++;
            }
            html += '</div>';
            if (itemsExist && updateInfo) {
                html += `<p class="price-update-info" style="text-align:center; font-size: ${f.smallTextFontSize}; margin-top:15px;">${updateInfo}</p>`;
            }
            contentDiv.innerHTML = html;
        }
        
        // --- Universal Branding ---
        function applyGlobalBranding(canvas) { if (!canvas) return; canvas.querySelectorAll('.global-brand-logo-overlay, .global-brand-text-overlay').forEach(ov => ov.remove()); const enableLogo = getElementValue('brandLogoOnImageEnable'); if (enableLogo) { let logoUrl = getElementValue('brandLogoOnImageLogoUpload') || getElementValue('brandLogoOnImageLogoUrl'); const logoPosition = getElementValue('brandLogoOnImagePosition', 'bottom-left'); const logoHeight = getElementValue('brandLogoOnImageLogoHeight', '25') + 'px'; if (logoUrl) { const logoOverlay = document.createElement('div'); logoOverlay.className = `global-brand-logo-overlay brand-pos-${logoPosition}`; const logoImg = document.createElement('img'); logoImg.src = sanitizeHTML(logoUrl); logoImg.alt = "Brand Logo"; logoImg.style.maxHeight = logoHeight; logoImg.onerror = () => { logoImg.style.display = 'none'; }; logoOverlay.appendChild(logoImg); canvas.appendChild(logoOverlay); } } const enableText = getElementValue('brandTextOnImageEnable'); if (enableText) { const brandText = getElementValue('brandTextOnImageText'); const textPosition = getElementValue('brandTextOnImagePosition', 'bottom-right'); const textColor = getElementValue('brandTextOnImageTextColor', '#FFFFFF'); const textSize = getElementValue('brandTextOnImageTextSize', '12') + 'px'; if (brandText) { const textOverlay = document.createElement('div'); textOverlay.className = `global-brand-text-overlay brand-pos-${textPosition}`; const textSpan = document.createElement('span'); textSpan.textContent = sanitizeHTML(brandText); textSpan.style.color = textColor; textSpan.style.fontSize = textSize; textOverlay.appendChild(textSpan); canvas.appendChild(textOverlay); } } }
        
        // --- Dynamic UI & Utilities ---
        function updateFooterNote() { const noteElement = document.getElementById('footerNoteText'); if(noteElement) noteElement.textContent = "© 2025 Avinash Vagarnal AI Creatives. All Rights Reserved."; }
        function copyGeneratedTable() { if (currentTab !== 'textToTable') { showAlert('Switch to the Text to Table tab to use this feature.', 'warning'); return; } const tableElement = document.querySelector('#infographicCanvas .generated-table'); if (!tableElement) { showAlert('Please generate a table first.', 'danger'); return; } const copyDiv = document.createElement('div'); copyDiv.contentEditable = true; copyDiv.innerHTML = tableElement.outerHTML; document.body.appendChild(copyDiv); const range = document.createRange(); range.selectNodeContents(copyDiv); const selection = window.getSelection(); selection.removeAllRanges(); selection.addRange(range); try { document.execCommand('copy'); showAlert('Formatted table copied to clipboard!', 'success'); } catch (err) { showAlert('Could not copy table automatically.', 'danger'); console.error('Failed to copy table: ', err); } finally { document.body.removeChild(copyDiv); selection.removeAllRanges(); } }
        function showAlert(message, type) { const container = document.getElementById('tableAlertContainer'); if (!container) return; const alert = document.createElement('div'); alert.className = `alert alert-${type}`; alert.textContent = message; container.innerHTML = ''; container.appendChild(alert); setTimeout(() => { if (alert) alert.remove(); }, 3000); }
        function toggleTableFormatOptions() { const format = document.getElementById('tableDataFormat').value; document.getElementById('tableSeparatorGroup').style.display = format === 'tabular' ? 'block' : 'none'; document.getElementById('tableVerticalOptions').style.display = format === 'vertical' ? 'block' : 'none'; document.getElementById('tableHasHeaderGroup').style.display = format === 'tabular' ? 'block' : 'none'; generateInfographic(); }
        function buildInfoBlockControls() { const container = document.getElementById('infoBlockControlsContainer'); if (!container) return; container.innerHTML = ''; const count = getElementIntValue('infoBlockCount', 1); for (let i = 1; i <= count; i++) { const blockIdPrefix = `infoBlock${i}`; const blockHTML = `<h4>Block ${i}</h4><div class="control-group"> <label>Header</label> <input type="text" class="control-input info-block-control" id="${blockIdPrefix}Title" value="Info Header ${i}"> </div><div class="control-group"> <label>Content</label> <textarea class="control-input info-block-control" id="${blockIdPrefix}Content" rows="2">Details for block ${i}.</textarea> </div><div class="control-group"> <label>Image URL</label> <input type="url" class="control-input info-block-control" id="${blockIdPrefix}ImageUrl" placeholder="https://placehold.co/100x100/eee/777?text=Img${i}"> </div><div class="control-group"> <label>Upload Image</label> <input type="file" class="control-input info-block-control" id="${blockIdPrefix}ImageUpload" accept="image/*"> </div><div class="control-group"> <label>Image Position</label> <select class="control-input info-block-control" id="${blockIdPrefix}ImagePos"> <option value="none">None</option> <option value="left" ${i===1 ? 'selected' : ''}>Left</option> <option value="right">Right</option> </select> </div><div class="control-group"> <label>Image Size</label> <select class="control-input info-block-control" id="${blockIdPrefix}ImageSize"> <option value="medium">Medium (100px)</option> <option value="small">Small (70px)</option> <option value="large">Large (130px)</option> </select> </div>`; container.insertAdjacentHTML('beforeend', blockHTML); } }
        function attachDynamicListeners() { document.querySelectorAll('.info-block-control').forEach(input => { const eventType = (input.tagName === 'SELECT' || input.type === 'color' || input.type === 'range' || input.type === 'checkbox') ? 'change' : 'input'; input.addEventListener(eventType, () => generateInfographic()); }); document.querySelectorAll('.info-block-control[type="file"]').forEach(fileInput => { const blockIdPrefix = fileInput.id.replace('ImageUpload', ''); fileInput.addEventListener('change', (event) => handleImageUpload(event, fileInput.id, `${blockIdPrefix}ImageUrl`)); }); }

        /**
         * Converts a DOM element to a Base64 encoded SVG Data URL.
         * This is a robust way to capture complex CSS that html2canvas might struggle with.
         * @param {HTMLElement} element The element to render.
         * @returns {Promise<string|null>} A promise that resolves with the Data URL or null.
         */
        async function renderElementToDataURL(element) {
            const { width, height } = element.getBoundingClientRect();
            if (width === 0 || height === 0) return null;

            let styles = '';
            for (const sheet of document.styleSheets) {
                try {
                    for (const rule of sheet.cssRules) {
                        styles += rule.cssText;
                    }
                } catch (e) {
                    console.warn("Cannot read cross-origin stylesheet. Some styles may be missing in download.", sheet.href);
                }
            }
            
            // Create the SVG string with embedded styles and the element's HTML
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
                    <foreignObject width="100%" height="100%">
                        <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%;">
                            <style>${styles}</style>
                            ${element.outerHTML}
                        </div>
                    </foreignObject>
                </svg>`;

            // Use btoa to encode the SVG string for the Data URL
            // The unescape(encodeURIComponent()) part is a trick to handle Unicode characters correctly
            return "data:image/svg+xml;base64," + btoa(unescape(encodeURIComponent(svg)));
        }

        async function downloadInfographic() {
            const originalElement = document.getElementById('infographicCanvas');
            if (!originalElement) { console.error("Canvas element not found."); return; }

            const canvasWidth = getElementIntValue('canvasWidth', 1080);
            const canvasHeight = getElementIntValue('canvasHeight', 1080);
            const infographicBgType = getElementValue('infographicBackgroundType', 'solid');

            const clone = originalElement.cloneNode(true);
            
            // --- ROBUST FIX for Stats, Info, and other complex CSS elements ---
            // This process pre-renders complex elements into simple images before capture.
            const renderPromises = [];
            const complexSelectors = ['.stat-card', '.info-block-item']; 

            complexSelectors.forEach(selector => {
                const originalNodes = originalElement.querySelectorAll(selector);
                const clonedNodes = clone.querySelectorAll(selector);

                originalNodes.forEach((node, index) => {
                    const clonedNode = clonedNodes[index];
                    if (clonedNode) {
                        const promise = renderElementToDataURL(node).then(dataUrl => {
                            if (dataUrl) {
                                const img = new Image();
                                img.src = dataUrl;
                                const rect = node.getBoundingClientRect();
                                img.width = rect.width;
                                img.height = rect.height;
                                // Replace the complex div with a simple image in the clone
                                if (clonedNode.parentNode) {
                                    clonedNode.parentNode.replaceChild(img, clonedNode);
                                }
                            }
                        });
                        renderPromises.push(promise);
                    }
                });
            });

            // Wait for all elements to be replaced with their image versions.
            await Promise.all(renderPromises);
            
            // Also handle charts by replacing their canvas with an image
            const chartInstances = { '#pieChartCanvas': pieChartInstance, '#barChartCanvas': barChartInstance };
            for (const [selector, instance] of Object.entries(chartInstances)) {
                if (instance) {
                    const chartCanvas = clone.querySelector(selector);
                    if (chartCanvas) {
                        const img = new Image();
                        img.src = instance.toBase64Image();
                        chartCanvas.parentNode.replaceChild(img, chartCanvas);
                    }
                }
            }
            
            const renderContainer = document.createElement('div');
            renderContainer.style.position = 'absolute';
            renderContainer.style.left = '-9999px';
            renderContainer.style.top = '0px';
            renderContainer.style.width = canvasWidth + 'px';
            renderContainer.style.height = canvasHeight + 'px';
            renderContainer.style.overflow = 'hidden';

            clone.style.transform = 'none';
            clone.style.position = 'absolute';
            clone.style.top = '0';
            clone.style.left = '0';

            renderContainer.appendChild(clone);
            document.body.appendChild(renderContainer);

            try {
                // Wait for all images (including newly generated ones) to load
                const images = Array.from(clone.querySelectorAll('img'));
                await Promise.all(images.map(img => new Promise(resolve => {
                    if (img.complete && img.naturalHeight !== 0) resolve();
                    else { img.onload = img.onerror = resolve; }
                })));

                // Final capture
                const canvas = await html2canvas(renderContainer, {
                    width: canvasWidth,
                    height: canvasHeight,
                    scale: 2,
                    useCORS: true,
                    backgroundColor: infographicBgType === 'transparent' ? null : getComputedStyle(originalElement).backgroundColor,
                });

                const imageFormat = infographicBgType === 'transparent' ? 'image/png' : 'image/jpeg';
                const fileExtension = infographicBgType === 'transparent' ? 'png' : 'jpg';
                const image = canvas.toDataURL(imageFormat, 0.95);
                const link = document.createElement('a');
                link.download = `infographic-${currentTab}-${canvasWidth}x${canvasHeight}.${fileExtension}`;
                link.href = image;
                link.click();

            } catch (err) {
                console.error("html2canvas failed:", err);
            } finally {
                document.body.removeChild(renderContainer);
            }
        }
        
        // --- Initialization on DOMContentLoaded ---
        document.addEventListener('DOMContentLoaded', () => { 
            buildInfoBlockControls(); 
            attachAllListeners();
            
            const tableTextInput = document.getElementById('tableInputText'); 
            if (tableTextInput) { tableTextInput.value = 'ಸ್ಥಾನ : 01\nದೇಶ : ಅಮೆರಿಕ\nಕಂಪೆನಿಗಳ ಸಂಖ್ಯೆ : 1,873\nಮಾರುಕಟ್ಟೆ ಮೌಲ್ಯ : 57.11\n\nಸ್ಥಾನ : 02\nದೇಶ : ಜಪಾನ್\nಕಂಪೆನಿಗಳ ಸಂಖ್ಯೆ : 404\nಮಾರುಕಟ್ಟೆ ಮೌಲ್ಯ : 5.11\n\nಸ್ಥಾನ : 03\nದೇಶ : ಭಾರತ\nಕಂಪೆನಿಗಳ ಸಂಖ್ಯೆ : 348\nಮಾರುಕಟ್ಟೆ ಮೌಲ್ಯ : 3.75'; } 
            document.getElementById('tableDataFormat').value = 'vertical'; 
            toggleTableFormatOptions(); 
            
            const defaultPresetButton = document.querySelector('#canvasPresetButtons .preset-btn.active'); 
            if (defaultPresetButton) { document.getElementById('canvasWidth').value = defaultPresetButton.dataset.width; document.getElementById('canvasHeight').value = defaultPresetButton.dataset.height; } 
            
            updateFooterNote(); 
            generateInfographic(true); // Initial generation
            window.addEventListener('resize', fitCanvasToContainer); 
        });
    </script>
</body>
</html>
